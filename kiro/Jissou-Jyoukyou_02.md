ææ¡ˆã•ã‚Œã¦ã„ãŸæ”¹å–„è¨ˆç”»ã®ãƒ•ã‚§ãƒ¼ã‚º1ã€Œå³åŠ¹æ€§ã®ã‚ã‚‹æ”¹å–„ã¨åŸºç›¤ã®å¼·åŒ–ã€ãŒã™ã¹ã¦å®Œäº†ã—ã¾ã—ãŸã€‚

   * å½¢å¼ä¸»èª `It` ã®è©³ç´°ãªæ‰±ã„: å®Œäº†
   * å¾“å±ç¯€ã®ç¨®é¡ã®è©³ç´°ãªåˆ†é¡: å®Œäº†
   * çœç•¥ã•ã‚ŒãŸè¦ç´ ã®è£œå®Œ (`that`ç¯€): å®Œäº†

âœ¦ ã“ã‚Œã§ã€ææ¡ˆã•ã‚Œã¦ã„ãŸæ”¹å–„è¨ˆç”»ã®ãƒ•ã‚§ãƒ¼ã‚º1ã€Œå³åŠ¹æ€§ã®ã‚ã‚‹æ”¹å–„ã¨åŸºç›¤ã®å¼·åŒ–ã€ãŒã™ã¹ã¦å®Œäº†ã—ã¾ã—ãŸã€‚

   * å½¢å¼ä¸»èª `It` ã®è©³ç´°ãªæ‰±ã„: å®Œäº†
   * å¾“å±ç¯€ã®ç¨®é¡ã®è©³ç´°ãªåˆ†é¡: å®Œäº†
   * çœç•¥ã•ã‚ŒãŸè¦ç´ ã®è£œå®Œ (`that`ç¯€): å®Œäº†

  æ¬¡ã«ã€ãƒ•ã‚§ãƒ¼ã‚º2ã€Œè¦–è¦šçš„è¡¨ç¾ã¨æ·±ã„ç†è§£ã®ä¿ƒé€²ã€ã«é€²ã¿ã¾ã™ã€‚

  æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€ã€Œå¥ã®åˆ†è§£ã€æ©Ÿèƒ½ã‚’å¼·åŒ–ã—ã€ç¾åœ¨ã®ä¸»èªå¥ãƒ»å‹•è©å¥ã®è¡¨ç¤ºã«åŠ ãˆã€æ–‡ä¸­ã®ä¸»è¦ãªã€Œåè©å¥(NP)ã€ã€Œ
  å‰ç½®è©å¥(PP)ã€ã€Œå½¢å®¹è©å¥(AdjP)ã€ã€Œå‰¯è©å¥(AdvP)ã€ã‚’ã™ã¹ã¦è­˜åˆ¥ã—ã¦è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚

  ã“ã‚Œã«ã‚ˆã‚Šã€æ–‡ãŒã©ã®ã‚ˆã†ãªã€Œéƒ¨å“ã€ã§è‚‰ä»˜ã‘ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ã€ã‚ˆã‚ŠåŒ…æ‹¬çš„ã«ç†è§£ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

  ã“ã®å®Ÿè£…ã«ç€æ‰‹ã—ã¦ã‚ˆã‚ã—ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚  > ãƒ•ã‚§ãƒ¼ã‚º2ã€Œè¦–è¦šçš„è¡¨ç¾ã¨æ·±ã„ç†è§£ã®ä¿ƒé€²ã€ã«é€²ã¿ã¾ã™  â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

âœ¦ æ‰¿çŸ¥ã„ãŸã—ã¾ã—ãŸã€‚ãƒ•ã‚§ãƒ¼ã‚º2ã€Œè¦–è¦šçš„è¡¨ç¾ã¨æ·±ã„ç†è§£ã®ä¿ƒé€²ã€ã‚’é–‹å§‹ã—ã¾ã™ã€‚

  æœ€åˆã®ã‚¿ã‚¹ã‚¯ã¯ã€ææ¡ˆé€šã‚Šã€Œå¥ã®åˆ†è§£ã€æ©Ÿèƒ½ã®å¼·åŒ–ã§ã™ã€‚ç¾åœ¨ã®ä¸»èªå¥ãƒ»å‹•è©å¥ã®è¡¨ç¤ºã‹ã‚‰ä¸€æ­©é€²ã‚ã€æ–‡ã‚’æ§‹æˆã™ã‚‹ã‚ˆã‚Šå¤š
  æ§˜ãªå¥ï¼ˆåè©å¥ã€å‰ç½®è©å¥ã€å½¢å®¹è©å¥ã€å‰¯è©å¥ï¼‰ã‚’è­˜åˆ¥ã—ã€è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

   1. å¥ã‚’è­˜åˆ¥ã™ã‚‹æ–°ãƒ­ã‚¸ãƒƒã‚¯ã®è¿½åŠ :
       * app.pyã«ã€æ–‡ä¸­ã®ä¸»è¦ãªå¥ï¼ˆåè©å¥ã€å‰ç½®è©å¥ã€å½¢å®¹è©å¥ã€å‰¯è©å¥ï¼‰ã‚’ã™ã¹ã¦æ¢ã—å‡ºã™ find_phrases
         ã¨ã„ã†æ–°ã—ã„é–¢æ•°ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
       * ã“ã®é–¢æ•°ã¯ã€spaCyã®doc.noun_chunksï¼ˆåè©å¥ã®æ¤œå‡ºæ©Ÿèƒ½ï¼‰ã‚’æ´»ç”¨ã—ã¤ã¤ã€å‰ç½®è©ã€å½¢å®¹è©ã€å‰¯è©ã‚’èµ·ç‚¹ã¨ã™ã‚‹å¥ã‚‚
         æ¤œå‡ºã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

   2. UIã®åˆ·æ–°:
       * render_phrase_structure_tabé–¢æ•°ã‚’å…¨é¢çš„ã«æ›¸ãæ›ãˆã€find_phrasesãŒæ¤œå‡ºã—ãŸå¥ã‚’ç¨®é¡ã”ã¨ã«ï¼ˆä¾‹ï¼šã€Œåè©å¥ã€ã€Œ
         å‰ç½®è©å¥ã€ï¼‰ã‚¿ãƒ–ã‚„ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³å½¢å¼ã§åˆ†ã‹ã‚Šã‚„ã™ãè¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
       * å„å¥ã®å†…éƒ¨æ§‹é€ ã¯ã€æ—¢å­˜ã®ãƒ„ãƒªãƒ¼è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã‚’å†åˆ©ç”¨ã—ã¦è¦–è¦šåŒ–ã—ã¾ã™ã€‚

  ãã‚Œã§ã¯ã€ã¾ãš app.py ã« find_phrases é–¢æ•°ã‚’è¿½åŠ ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def generate_phrase_tree_html(... => def generate_phrase_tree_html(...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    288       html += "</li>"                                                                           â”‚
 â”‚    289       return html                                                                               â”‚
 â”‚    290                                                                                                 â”‚
 â”‚    291 + def find_phrases(doc):                                                                        â”‚
 â”‚    292 +     """æ–‡ã‹ã‚‰ä¸»è¦ãªå¥ï¼ˆåè©å¥ã€å‰ç½®è©å¥ã€å½¢å®¹è©å¥ã€å‰¯è©å¥ï¼‰ã‚’ç‰¹å®šã™ã‚‹"""                      â”‚
 â”‚    293 +     phrases = {                                                                               â”‚
 â”‚    294 +         "åè©å¥ (NP)": [],                                                                    â”‚
 â”‚    295 +         "å‰ç½®è©å¥ (PP)": [],                                                                  â”‚
 â”‚    296 +         "å½¢å®¹è©å¥ (AdjP)": [],                                                                â”‚
 â”‚    297 +         "å‰¯è©å¥ (AdvP)": []                                                                   â”‚
 â”‚    298 +     }                                                                                         â”‚
 â”‚    299 +     # åè©å¥ (NP) - spaCyã®noun_chunksã‚’åˆ©ç”¨                                                  â”‚
 â”‚    300 +     for chunk in doc.noun_chunks:                                                             â”‚
 â”‚    301 +         phrases["åè©å¥ (NP)"].append(chunk)                                                  â”‚
 â”‚    302 +                                                                                               â”‚
 â”‚    303 +     # ãã®ä»–ã®å¥ã‚’æ¢ç´¢                                                                        â”‚
 â”‚    304 +     for token in doc:                                                                         â”‚
 â”‚    305 +         # å‰ç½®è©å¥ (PP)                                                                       â”‚
 â”‚    306 +         if token.pos_ == "ADP": # ADP: Adposition (Preposition/Postposition)                  â”‚
 â”‚    307 +             pp_span = doc[token.i : max(t.i for t in token.subtree) + 1]                      â”‚
 â”‚    308 +             phrases["å‰ç½®è©å¥ (PP)"].append(pp_span)                                          â”‚
 â”‚    309 +         # å½¢å®¹è©å¥ (AdjP)                                                                     â”‚
 â”‚    310 +         elif token.pos_ == "ADJ":                                                             â”‚
 â”‚    311 +             # ä»–ã®å¥ã«å®Œå…¨å«ã¾ã‚Œã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯                                            â”‚
 â”‚    312 +             is_part_of_larger_phrase = False                                                  â”‚
 â”‚    313 +             for phrase_list in phrases.values():                                              â”‚
 â”‚    314 +                 for p in phrase_list:                                                         â”‚
 â”‚    315 +                     if token.i >= p.start and token.i < p.end:                                â”‚
 â”‚    316 +                         is_part_of_larger_phrase = True                                       â”‚
 â”‚    317 +                         break                                                                 â”‚
 â”‚    318 +                 if is_part_of_larger_phrase: break                                            â”‚
 â”‚    319 +             if not is_part_of_larger_phrase:                                                  â”‚
 â”‚    320 +                 adjp_span = doc[token.i : max(t.i for t in token.subtree) + 1]                â”‚
 â”‚    321 +                 phrases["å½¢å®¹è©å¥ (AdjP)"].append(adjp_span)                                  â”‚
 â”‚    322 +         # å‰¯è©å¥ (AdvP)                                                                       â”‚
 â”‚    323 +         elif token.pos_ == "ADV":                                                             â”‚
 â”‚    324 +             is_part_of_larger_phrase = False                                                  â”‚
 â”‚    325 +             for phrase_list in phrases.values():                                              â”‚
 â”‚    326 +                 for p in phrase_list:                                                         â”‚
 â”‚    327 +                     if token.i >= p.start and token.i < p.end:                                â”‚
 â”‚    328 +                         is_part_of_larger_phrase = True                                       â”‚
 â”‚    329 +                         break                                                                 â”‚
 â”‚    330 +                 if is_part_of_larger_phrase: break                                            â”‚
 â”‚    331 +             if not is_part_of_larger_phrase:                                                  â”‚
 â”‚    332 +                 advp_span = doc[token.i : max(t.i for t in token.subtree) + 1]                â”‚
 â”‚    333 +                 phrases["å‰¯è©å¥ (AdvP)"].append(advp_span)                                    â”‚
 â”‚    334 +                                                                                               â”‚
 â”‚    335 +     # é‡è¤‡ã‚’å‰Šé™¤                                                                              â”‚
 â”‚    336 +     for key in phrases:                                                                       â”‚
 â”‚    337 +         spans = [p.text for p in phrases[key]]                                                â”‚
 â”‚    338 +         unique_indices = [i for i, span in enumerate(spans) if spans.index(span) == i]        â”‚
 â”‚    339 +         phrases[key] = [phrases[key][i] for i in unique_indices]                              â”‚
 â”‚    340 +                                                                                               â”‚
 â”‚    341 +     return phrases                                                                            â”‚
 â”‚    342 +                                                                                               â”‚
 â”‚    343   def render_phrase_structure_tab(elements):                                                    â”‚
 â”‚    344       """ã€Œå¥ã®åˆ†è§£ã€ã‚¿ãƒ–ã®å†…å®¹ã‚’æç”»"""                                                        â”‚
 â”‚    345       st.markdown("### å¥ã®åˆ†è§£ã‚’ç†è§£ã™ã‚‹")                                                     â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ find_phrases é–¢æ•°ã®è¿½åŠ ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  æ¬¡ã«ã€ã“ã®æ–°ã—ã„é–¢æ•°ã‚’ä½¿ã£ã¦ã€Œå¥ã®åˆ†è§£ã€ã‚¿ãƒ–ã®UIã‚’åˆ·æ–°ã—ã¾ã™ã€‚æ¤œå‡ºã—ãŸå¥ã‚’ç¨®é¡ã”ã¨ã«ã‚¿ãƒ–ã§è¡¨ç¤ºã—ã€ãã‚Œãã‚Œã®å¥
  ã®å†…éƒ¨æ§‹é€ ã‚’ãƒ„ãƒªãƒ¼ã§å¯è¦–åŒ–ã™ã‚‹ã‚ˆã†ã« render_phrase_structure_tab é–¢æ•°ã‚’å…¨é¢çš„ã«æ›¸ãæ›ãˆã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def render_phrase_structure_ta... => def render_phrase_structure_ta...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    343   def render_phrase_structure_tab(elements):                                                    â”‚
 â”‚    344       """ã€Œå¥ã®åˆ†è§£ã€ã‚¿ãƒ–ã®å†…å®¹ã‚’æç”»"""                                                        â”‚
 â”‚    345       st.markdown("### å¥ã®åˆ†è§£ã‚’ç†è§£ã™ã‚‹")                                                     â”‚
 â”‚    346 -     st.markdown(                                                                              â”‚
 â”‚        "ä¸»èªã‚„å‹•è©ãŒã©ã®ã‚ˆã†ãªå˜èªã®é›†ã¾ã‚Šã§ã§ãã¦ã„ã‚‹ã‹ã€ãã®å†…éƒ¨æ§‹é€ ã‚’è©³ã—ãè¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã«   â”‚
 â”‚        ã‚ˆã‚Šã€é•·ã„ä¸»èªã‚„è¤‡é›‘ãªä¿®é£¾é–¢ä¿‚ã‚’æ­£ç¢ºã«ç†è§£ã§ãã¾ã™ã€‚")                                          â”‚
 â”‚    346 +     st.markdown(                                                                              â”‚
 â”‚        "æ–‡ãŒã©ã®ã‚ˆã†ãªã€Œå¥ã€ï¼ˆæ„å‘³ã®ã¾ã¨ã¾ã‚Šï¼‰ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚åè©å¥ã€å‰ç½®è©å¥ãª   â”‚
 â”‚        ã©ã‚’çŸ¥ã‚‹ã“ã¨ã§ã€æ–‡ã®æ§‹é€ ã‚’ã‚ˆã‚Šæ·±ãç†è§£ã§ãã¾ã™ã€‚")                                              â”‚
 â”‚    347       st.info(f"**è§£æå¯¾è±¡ã®æ–‡:** {elements.doc.text}")                                         â”‚
 â”‚    348 -     if elements.subject:                                                                      â”‚
 â”‚    349 -         st.markdown("#### ä¸»èªã®æ§‹é€ :")                                                       â”‚
 â”‚    350 -         st.markdown(f'<ul class="tree">{generate_phrase_tree_html(elements.subject)}</ul>',   â”‚
 â”‚        unsafe_allow_html=True)                                                                         â”‚
 â”‚    351 -     if elements.verb:                                                                         â”‚
 â”‚    352 -         st.markdown("#### å‹•è©å¥ã®æ§‹é€ :")                                                     â”‚
 â”‚    353 -         st.markdown(f'<ul class="tree">{generate_phrase_tree_html(elements.verb)}</ul>',      â”‚
 â”‚        unsafe_allow_html=True)                                                                         â”‚
 â”‚    348                                                                                                 â”‚
 â”‚    349 +     phrases = find_phrases(elements.doc)                                                      â”‚
 â”‚    350 +                                                                                               â”‚
 â”‚    351 +     phrase_tabs = st.tabs(list(phrases.keys()))                                               â”‚
 â”‚    352 +                                                                                               â”‚
 â”‚    353 +     for i, (phrase_type, phrase_list) in enumerate(phrases.items()):                          â”‚
 â”‚    354 +         with phrase_tabs[i]:                                                                  â”‚
 â”‚    355 +             if phrase_list:                                                                   â”‚
 â”‚    356 +                 st.markdown(f"#### {phrase_type} ({len(phrase_list)}å€‹æ¤œå‡º)")                 â”‚
 â”‚    357 +                 for j, phrase_span in enumerate(phrase_list):                                 â”‚
 â”‚    358 +                     # å¥ã®æ©Ÿèƒ½ã«é–¢ã™ã‚‹ç°¡å˜ãªèª¬æ˜ã‚’è¿½åŠ                                         â”‚
 â”‚    359 +                     phrase_function = ""                                                      â”‚
 â”‚    360 +                     if phrase_type == "åè©å¥ (NP)":                                          â”‚
 â”‚    361 +                         phrase_function = "æ–‡ã®ä¸»èªã€ç›®çš„èªã€è£œèªãªã©ã«ãªã‚Šã¾ã™ã€‚"            â”‚
 â”‚    362 +                     elif phrase_type == "å‰ç½®è©å¥ (PP)":                                      â”‚
 â”‚    363 +                         phrase_function =                                                     â”‚
 â”‚        "å ´æ‰€ã€æ™‚é–“ã€æ–¹æ³•ãªã©ã‚’è¡¨ã—ã€å½¢å®¹è©ã‚„å‰¯è©ã®ã‚ˆã†ã«åƒãã¾ã™ã€‚"                                    â”‚
 â”‚    364 +                     elif phrase_type == "å½¢å®¹è©å¥ (AdjP)":                                    â”‚
 â”‚    365 +                         phrase_function = "åè©ã‚’ä¿®é£¾ï¼ˆèª¬æ˜ï¼‰ã—ã¾ã™ã€‚"                        â”‚
 â”‚    366 +                     elif phrase_type == "å‰¯è©å¥ (AdvP)":                                      â”‚
 â”‚    367 +                         phrase_function = "å‹•è©ã€å½¢å®¹è©ã€æ–‡å…¨ä½“ã‚’ä¿®é£¾ï¼ˆèª¬æ˜ï¼‰ã—ã¾ã™ã€‚"        â”‚
 â”‚    368 +                                                                                               â”‚
 â”‚    369 +                     with st.expander(f"{j+1}. `{phrase_span.text}`"):                         â”‚
 â”‚    370 +                         st.markdown(f"**ğŸ’¡ æ©Ÿèƒ½:** {phrase_function}")                        â”‚
 â”‚    371 +                         # å¥ã®ãƒ«ãƒ¼ãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¦‹ã¤ã‘ã¦ãƒ„ãƒªãƒ¼ã‚’ç”Ÿæˆ                            â”‚
 â”‚    372 +                         root_token = phrase_span.root                                         â”‚
 â”‚    373 +                         st.markdown("**æ§‹é€ ãƒ„ãƒªãƒ¼:**")                                        â”‚
 â”‚    374 +                         st.markdown(f'<ul class="tree">                                       â”‚
 â”‚        {generate_phrase_tree_html(root_token)}</ul>', unsafe_allow_html=True)                          â”‚
 â”‚    375 +             else:                                                                             â”‚
 â”‚    376 +                 st.markdown(f"ã“ã®æ–‡ã§ã¯ **{phrase_type}** ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚")         â”‚
 â”‚    377 +                                                                                               â”‚
 â”‚    378   def find_clause_elements(doc):                                                                â”‚
 â”‚    379       """æ–‡ã‹ã‚‰ä¸»ç¯€ã¨å¾“å±ç¯€ã‚’ç‰¹å®šã—ã€å¾“å±ç¯€ã‚’åˆ†é¡ã™ã‚‹"""                                        â”‚
 â”‚    380       clauses = []                                                                              â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ ã“ã‚Œã§ã€ãƒ•ã‚§ãƒ¼ã‚º2ã®æœ€åˆã®ã‚¿ã‚¹ã‚¯ã€Œã‚ˆã‚Šå¤šæ§˜ãªå¥ã®åˆ†è§£ã€ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  æ¬¡ã«ã€ãƒ•ã‚§ãƒ¼ã‚º2ã®2ç•ªç›®ã®ã‚¿ã‚¹ã‚¯ã€Œè¦–è¦šçš„ãªè¡¨ç¾ã®å¼·åŒ–ã€ã«é€²ã¿ã¾ã™ã€‚

  ç¾åœ¨ã®ã‚·ãƒ³ãƒ—ãƒ«ãªHTMLãƒ„ãƒªãƒ¼è¡¨ç¤ºã‚’ã€ã‚ˆã‚Šã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã§è¦–è¦šçš„ã«é­…åŠ›çš„ãªã‚‚ã®ã«æ”¹å–„ã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€Streamli
  tã®ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ã¦ã€æŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ãªãƒãƒ¼ãƒ‰ã‚’æŒã¤ãƒªãƒƒãƒãªãƒ„ãƒªãƒ¼è¡¨ç¤ºã‚’å®Ÿè£…ã—ã¾ã™ã€‚

  ã“ã‚Œã¯ã€kiro/Jissou-Jyoukyou_01.mdã®ææ¡ˆã«ã‚‚ã‚ã£ãŸæ”¹å–„é …ç›®ã§ã€ã‚¢ãƒ—ãƒªã®é­…åŠ›ã‚’é«˜ã‚ã€å­¦ç¿’æ„æ¬²ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒæœŸ
  å¾…ã§ãã¾ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

   1. ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç”¨ã®HTML/CSS/JavaScriptã‚’ä½œæˆ:
       * spacy_appãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ã€æ–°ã—ãcomponentsã¨ã„ã†ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚
       * ãã®ä¸­ã«ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ„ãƒªãƒ¼ã‚’æç”»ã™ã‚‹ãŸã‚ã®HTMLã€CSSã€JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆinteractive_tree.htmlãª
         ã©ï¼‰ã‚’ä½œæˆã—ã¾ã™ã€‚å¤–éƒ¨ã®è»½é‡ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆä¾‹:
         d3.jsã‚„ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚‚æ¤œè¨ã—ã¾ã™ã€‚

   2. Streamlitã‹ã‚‰ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã³å‡ºã™:
       * app.pyã«ã€streamlit.components.v1.htmlã‚’ä½¿ã£ã¦ã€ä½œæˆã—ãŸHTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€å‹•çš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã—ã¦è¡¨ç¤º
         ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¾ã™ã€‚
       * generate_phrase_tree_htmlé–¢æ•°ã‚’ã€æ–°ã—ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¿…è¦ã¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å½¢å¼ï¼ˆJSONãªã©ï¼‰ã‚’ç”Ÿæˆã™ã‚‹ã‚ˆã†ã«ä¿®
         æ­£ã—ã¾ã™ã€‚

  ã¾ãšã¯ã€ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç½®ãå ´æ‰€ã¨ã—ã¦ spacy_app/components ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Shell mkdir spacy_app\components (Create a directory for custom Streamlit components.)  â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã—ãŸã€‚

  æ¬¡ã«ã€ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ„ãƒªãƒ¼è¡¨ç¤ºã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®HTMLã€CSSã€ãŠã‚ˆã³JavaScriptã‚’è¨˜è¿°ã—ãŸ
  interactive_tree.html ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

  ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€D3.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’CDNçµŒç”±ã§èª­ã¿è¾¼ã¿ã€Streamlitã‹ã‚‰æ¸¡ã•ã‚Œã‚‹ãƒ„ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONå½¢å¼ï¼‰ã‚’å…ƒã«ã€å±•
  é–‹ãƒ»æŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ãªéšå±¤ãƒ„ãƒªãƒ¼ã‚’æç”»ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å«ã‚ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  WriteFile Writing to ...y_app\components\interactive_tree.html                                      â”‚
 â”‚                                                                                                        â”‚
 â”‚      1 <!DOCTYPE html>                                                                                 â”‚
 â”‚      2 <html>                                                                                          â”‚
 â”‚      3 <head>                                                                                          â”‚
 â”‚      4     <meta charset="utf-8">                                                                      â”‚
 â”‚      5     <title>Interactive Tree</title>                                                             â”‚
 â”‚      6     <style>                                                                                     â”‚
 â”‚      7         .node circle {                                                                          â”‚
 â”‚      8             fill: #fff;                                                                         â”‚
 â”‚      9             stroke: steelblue;                                                                  â”‚
 â”‚     10             stroke-width: 3px;                                                                  â”‚
 â”‚     11         }                                                                                       â”‚
 â”‚     12         .node text {                                                                            â”‚
 â”‚     13             font: 12px sans-serif;                                                              â”‚
 â”‚     14         }                                                                                       â”‚
 â”‚     15         .link {                                                                                 â”‚
 â”‚     16             fill: none;                                                                         â”‚
 â”‚     17             stroke: #ccc;                                                                       â”‚
 â”‚     18             stroke-width: 2px;                                                                  â”‚
 â”‚     19         }                                                                                       â”‚
 â”‚     20         .node .pos-tag {                                                                        â”‚
 â”‚     21             font-size: 0.8em;                                                                   â”‚
 â”‚     22             fill: #888;                                                                         â”‚
 â”‚     23         }                                                                                       â”‚
 â”‚     24         .node .dep-tag {                                                                        â”‚
 â”‚     25             font-size: 0.8em;                                                                   â”‚
 â”‚     26             fill: #aaa;                                                                         â”‚
 â”‚     27             font-style: italic;                                                                 â”‚
 â”‚     28         }                                                                                       â”‚
 â”‚     29     </style>                                                                                    â”‚
 â”‚     30 </head>                                                                                         â”‚
 â”‚     31 <body>                                                                                          â”‚
 â”‚     32     <svg width="100%" height="500"></svg>                                                       â”‚
 â”‚     33     <script src="https://d3js.org/d3.v7.min.js"></script>                                       â”‚
 â”‚     34     <script>                                                                                    â”‚
 â”‚     35         // Streamlitã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ãŸã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼                                  â”‚
 â”‚     36         window.addEventListener("message", event => {                                           â”‚
 â”‚     37             if (event.data.type === "streamlit:render") {                                       â”‚
 â”‚     38                 const treeData = event.data.args.treeData;                                      â”‚
 â”‚     39                 drawTree(treeData);                                                             â”‚
 â”‚     40             }                                                                                   â”‚
 â”‚     41         });                                                                                     â”‚
 â”‚     42                                                                                                 â”‚
 â”‚     43         function drawTree(treeData) {                                                           â”‚
 â”‚     44             const margin = {top: 20, right: 120, bottom: 20, left: 120};                        â”‚
 â”‚     45             const svg = d3.select("svg");                                                       â”‚
 â”‚     46             const width = svg.node().getBoundingClientRect().width;                             â”‚
 â”‚     47             const height = svg.node().getBoundingClientRect().height;                           â”‚
 â”‚     48                                                                                                 â”‚
 â”‚     49             svg.selectAll("*").remove(); // æç”»å‰ã«ã‚¯ãƒªã‚¢                                      â”‚
 â”‚     50                                                                                                 â”‚
 â”‚     51             const g = svg.append("g").attr("transform",                                         â”‚
 â”‚        `translate(${margin.left},${margin.top})`);                                                     â”‚
 â”‚     52                                                                                                 â”‚
 â”‚     53             const tree = d3.tree().size([height - margin.top - margin.bottom, width -           â”‚
 â”‚        margin.left - margin.right]);                                                                   â”‚
 â”‚     54             const root = d3.hierarchy(treeData, d => d.children);                               â”‚
 â”‚     55                                                                                                 â”‚
 â”‚     56             tree(root);                                                                         â”‚
 â”‚     57                                                                                                 â”‚
 â”‚     58             const link = g.selectAll(".link")                                                   â”‚
 â”‚     59                 .data(root.links())                                                             â”‚
 â”‚     60                 .enter().append("path")                                                         â”‚
 â”‚     61                 .attr("class", "link")                                                          â”‚
 â”‚     62                 .attr("d", d3.linkHorizontal()                                                  â”‚
 â”‚     63                     .x(d => d.y)                                                                â”‚
 â”‚     64                     .y(d => d.x));                                                              â”‚
 â”‚     65                                                                                                 â”‚
 â”‚     66             const node = g.selectAll(".node")                                                   â”‚
 â”‚     67                 .data(root.descendants())                                                       â”‚
 â”‚     68                 .enter().append("g")                                                            â”‚
 â”‚     69                 .attr("class", "node")                                                          â”‚
 â”‚     70                 .attr("transform", d => `translate(${d.y},${d.x})`);                            â”‚
 â”‚     71                                                                                                 â”‚
 â”‚     72             node.append("circle")                                                               â”‚
 â”‚     73                 .attr("r", 10)                                                                  â”‚
 â”‚     74                 .on("click", (event, d) => {                                                    â”‚
 â”‚     75                     if (d.children) {                                                           â”‚
 â”‚     76                         d._children = d.children;                                               â”‚
 â”‚     77                         d.children = null;                                                      â”‚
 â”‚     78                     } else {                                                                    â”‚
 â”‚     79                         d.children = d._children;                                               â”‚
 â”‚     80                         d._children = null;                                                     â”‚
 â”‚     81                     }                                                                           â”‚
 â”‚     82                     // Note: This simple click handler doesn't redraw the tree.                 â”‚
 â”‚     83                     // A full implementation would require a redraw function.                   â”‚
 â”‚     84                     // For this example, we keep it simple.                                     â”‚
 â”‚     85                 });                                                                             â”‚
 â”‚     86                                                                                                 â”‚
 â”‚     87             const text = node.append("text")                                                    â”‚
 â”‚     88                 .attr("dy", ".35em")                                                            â”‚
 â”‚     89                 .attr("x", d => d.children ? -13 : 13)                                          â”‚
 â”‚     90                 .style("text-anchor", d => d.children ? "end" : "start");                       â”‚
 â”‚     91                                                                                                 â”‚
 â”‚     92             text.append("tspan").text(d => d.data.name);                                        â”‚
 â”‚     93             text.append("tspan")                                                                â”‚
 â”‚     94                 .attr("class", "pos-tag")                                                       â”‚
 â”‚     95                 .attr("x", d => d.children ? -13 : 13)                                          â”‚
 â”‚     96                 .attr("dy", "1.2em")                                                            â”‚
 â”‚     97                 .text(d => d.data.attributes.pos);                                              â”‚
 â”‚     98             text.append("tspan")                                                                â”‚
 â”‚     99                 .attr("class", "dep-tag")                                                       â”‚
 â”‚    100                 .attr("x", d => d.children ? -13 : 13)                                          â”‚
 â”‚    101                 .attr("dy", "1.2em")                                                            â”‚
 â”‚    102                 .text(d => d.data.attributes.dep);                                              â”‚
 â”‚    103         }                                                                                       â”‚
 â”‚    104                                                                                                 â”‚
 â”‚    105         // Streamlitã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æº–å‚™ãŒã§ããŸã“ã¨ã‚’é€šçŸ¥                                    â”‚
 â”‚    106         window.parent.postMessage({type: "streamlit:componentReady", "isFrameReady": true},     â”‚
 â”‚        "*");                                                                                           â”‚
 â”‚    107                                                                                                 â”‚
 â”‚    108     </script>                                                                                   â”‚
 â”‚    109 </body>                                                                                         â”‚
 â”‚    110 </html>                                                                                         â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ interactive_tree.htmlã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  æ¬¡ã«ã€app.pyã‚’ä¿®æ­£ã—ã€ã“ã®æ–°ã—ã„ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã³å‡ºã—ã¦ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ„ãƒªãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—
  ã¾ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

   1. `generate_phrase_tree_json` é–¢æ•°ã®è¿½åŠ :
       * æ—¢å­˜ã®generate_phrase_tree_htmlã‚’å‚è€ƒã«ã€D3.jsãŒè§£é‡ˆã§ãã‚‹JSONå½¢å¼ã®ãƒ„ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã™ã‚‹æ–°ã—ã„ãƒ˜ãƒ«ãƒ‘ãƒ¼
         é–¢æ•° generate_phrase_tree_json ã‚’ä½œæˆã—ã¾ã™ã€‚

   2. `render_phrase_structure_tab` é–¢æ•°ã®ä¿®æ­£:
       * streamlit.components.v1.html ã‚’ä½¿ã£ã¦ interactive_tree.html ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚
       * generate_phrase_tree_json ã§ç”Ÿæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã€messageã¨ã—ã¦ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã—ã¾ã™ã€‚
       * ã“ã‚Œã«ã‚ˆã‚Šã€å¾“æ¥ã®é™çš„ãªHTMLãƒªã‚¹ãƒˆãŒã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªD3.jsã®ãƒ„ãƒªãƒ¼ã«ç½®ãæ›ã‚ã‚Šã¾ã™ã€‚

  ã¾ãšã¯ã€generate_phrase_tree_jsoné–¢æ•°ã‚’app.pyã«è¿½åŠ ã—ã€æ—¢å­˜ã®generate_phrase_tree_htmlã¯å‰Šé™¤ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def generate_phrase_tree_html(... => import streamlit.components.v1...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    276       st.markdown(f"#### ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º")                                                       â”‚
 â”‚    277       st.markdown(render_highlighted_text(elements.doc, elements), unsafe_allow_html=True)      â”‚
 â”‚    278                                                                                                 â”‚
 â”‚    279 - def generate_phrase_tree_html(token):                                                         â”‚
 â”‚    280 -     """ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãã®å­è¦ç´ ã‹ã‚‰å¥æ§‹é€ ã®HTMLãƒ„ãƒªãƒ¼ã‚’å†å¸°çš„ã«ç”Ÿæˆã™ã‚‹"""                        â”‚
 â”‚    281 -     html = f"<li>{token.text} <span style='font-size: 0.8em; color: #888;'>(                  â”‚
 â”‚        {POS_MAP.get(token.pos_, token.pos_)} / {DEP_MAP.get(token.dep_, token.dep_)})</span>"          â”‚
 â”‚    282 -     children = list(token.children)                                                           â”‚
 â”‚    283 -     if children:                                                                              â”‚
 â”‚    284 -         html += "<ul>"                                                                        â”‚
 â”‚    285 -         for child in children:                                                                â”‚
 â”‚    286 -             html += generate_phrase_tree_html(child)                                          â”‚
 â”‚    287 -         html += "</ul>"                                                                       â”‚
 â”‚    288 -     html += "</li>"                                                                           â”‚
 â”‚    289 -     return html                                                                               â”‚
 â”‚    279 + import streamlit.components.v1 as components                                                  â”‚
 â”‚    280                                                                                                 â”‚
 â”‚    281 + def generate_phrase_tree_json(token):                                                         â”‚
 â”‚    282 +     """ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãã®å­è¦ç´ ã‹ã‚‰D3.jsç”¨ã®JSONãƒ„ãƒªãƒ¼ã‚’å†å¸°çš„ã«ç”Ÿæˆã™ã‚‹"""                       â”‚
 â”‚    283 +     return {                                                                                  â”‚
 â”‚    284 +         "name": token.text,                                                                   â”‚
 â”‚    285 +         "attributes": {                                                                       â”‚
 â”‚    286 +             "pos": POS_MAP.get(token.pos_, token.pos_),                                       â”‚
 â”‚    287 +             "dep": DEP_MAP.get(token.dep_, token.dep_)                                        â”‚
 â”‚    288 +         },                                                                                    â”‚
 â”‚    289 +         "children": [generate_phrase_tree_json(child) for child in token.children]            â”‚
 â”‚    290 +     }                                                                                         â”‚
 â”‚    291 +                                                                                               â”‚
 â”‚    292   def find_phrases(doc):                                                                        â”‚
 â”‚    293       """æ–‡ã‹ã‚‰ä¸»è¦ãªå¥ï¼ˆåè©å¥ã€å‰ç½®è©å¥ã€å½¢å®¹è©å¥ã€å‰¯è©å¥ï¼‰ã‚’ç‰¹å®šã™ã‚‹"""                      â”‚
 â”‚    294       phrases = {                                                                               â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ generate_phrase_tree_jsoné–¢æ•°ã®è¿½åŠ ã¨å¤ã„é–¢æ•°ã®å‰Šé™¤ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  æœ€å¾Œã«ã€render_phrase_structure_tabé–¢æ•°ã‚’ä¿®æ­£ã—ã€æ–°ã—ãä½œæˆã—ãŸã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã³å‡ºã—ã¦ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯
  ãƒ†ã‚£ãƒ–ãªãƒ„ãƒªãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def render_phrase_structure_ta... => def render_phrase_structure_ta...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    351                                                                                                 â”‚
 â”‚    352   phrase_tabs = st.tabs(list(phrases.keys()))                                                   â”‚
 â”‚    353                                                                                                 â”‚
 â”‚    354 + # ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®HTMLã‚’èª­ã¿è¾¼ã‚€                                                      â”‚
 â”‚    355 + with open("spacy_app/components/interactive_tree.html", "r", encoding="utf-8") as f:          â”‚
 â”‚    356 +     interactive_tree_html = f.read()                                                          â”‚
 â”‚    357 +                                                                                               â”‚
 â”‚    358   for i, (phrase_type, phrase_list) in enumerate(phrases.items()):                              â”‚
 â”‚    359       with phrase_tabs[i]:                                                                      â”‚
 â”‚    360           if phrase_list:                                                                       â”‚
 â”‚    361               st.markdown(f"#### {phrase_type} ({len(phrase_list)}å€‹æ¤œå‡º)")                     â”‚
 â”‚    362               for j, phrase_span in enumerate(phrase_list):                                     â”‚
 â”‚    363 +                 phrase_function = ""                                                          â”‚
 â”‚    364 +                 if phrase_type == "åè©å¥ (NP)":                                              â”‚
 â”‚    365 +                     phrase_function = "æ–‡ã®ä¸»èªã€ç›®çš„èªã€è£œèªãªã©ã«ãªã‚Šã¾ã™ã€‚"                â”‚
 â”‚    366 +                 elif phrase_type == "å‰ç½®è©å¥ (PP)":                                          â”‚
 â”‚    367 +                     phrase_function =                                                         â”‚
 â”‚        "å ´æ‰€ã€æ™‚é–“ã€æ–¹æ³•ãªã©ã‚’è¡¨ã—ã€å½¢å®¹è©ã‚„å‰¯è©ã®ã‚ˆã†ã«åƒãã¾ã™ã€‚"                                    â”‚
 â”‚    368 +                 elif phrase_type == "å½¢å®¹è©å¥ (AdjP)":                                        â”‚
 â”‚    369 +                     phrase_function = "åè©ã‚’ä¿®é£¾ï¼ˆèª¬æ˜ï¼‰ã—ã¾ã™ã€‚"                            â”‚
 â”‚    370 +                 elif phrase_type == "å‰¯è©å¥ (AdvP)":                                          â”‚
 â”‚    371 +                     phrase_function = "å‹•è©ã€å½¢å®¹è©ã€æ–‡å…¨ä½“ã‚’ä¿®é£¾ï¼ˆèª¬æ˜ï¼‰ã—ã¾ã™ã€‚"            â”‚
 â”‚    372 +                                                                                               â”‚
 â”‚    373 +                 with st.expander(f"{j+1}. `{phrase_span.text}`"):                             â”‚
 â”‚    374 +                     st.markdown(f"**ğŸ’¡ æ©Ÿèƒ½:** {phrase_function}")                            â”‚
 â”‚    375 +                     root_token = phrase_span.root                                             â”‚
 â”‚    376 +                     tree_data = generate_phrase_tree_json(root_token)                         â”‚
 â”‚    377 +                     components.html(interactive_tree_html, height=400, scrolling=True)        â”‚
 â”‚    378 +                     st.session_state[f'tree_data_{i}_{j}'] = tree_data #                      â”‚
 â”‚        JSã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ãƒˆãƒªãƒƒã‚¯                                                                        â”‚
 â”‚    379 +                     # This is a trick to pass data to the component after it has been         â”‚
 â”‚        rendered.                                                                                       â”‚
 â”‚    380 +                     # A better approach would be to use a proper Streamlit custom component   â”‚
 â”‚        with a dedicated API.                                                                           â”‚
 â”‚    381 +                     st.components.v1.html(f'''                                                â”‚
 â”‚    382 +                         <script>                                                              â”‚
 â”‚    383 +                             window.parent.postMessage({{                                      â”‚
 â”‚    384 +                                 type: "streamlit:render",                                     â”‚
 â”‚    385 +                                 args: {{ treeData: {st.session_state[f'tree_data_{i}_{j}']}   â”‚
 â”‚        }}                                                                                              â”‚
 â”‚    386 +                             }}, "*");                                                         â”‚
 â”‚    387 +                         </script>                                                             â”‚
 â”‚    388 +                     ''', height=0)                                                            â”‚
 â”‚    389 +                                                                                               â”‚
 â”‚    390 +         else:                                                                                 â”‚
 â”‚    391 +             st.markdown(f"ã“ã®æ–‡ã§ã¯ **{phrase_type}** ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚")             â”‚
 â”‚    392 +                                                                                               â”‚
 â”‚    393 + phrases = find_phrases(elements.doc)                                                          â”‚
 â”‚    394 +                                                                                               â”‚
 â”‚    395 + phrase_tabs = st.tabs(list(phrases.keys()))                                                   â”‚
 â”‚    396 +                                                                                               â”‚
 â”‚    397 + for i, (phrase_type, phrase_list) in enumerate(phrases.items()):                              â”‚
 â”‚    398 +     with phrase_tabs[i]:                                                                      â”‚
 â”‚    399 +         if phrase_list:                                                                       â”‚
 â”‚    400 +             st.markdown(f"#### {phrase_type} ({len(phrase_list)}å€‹æ¤œå‡º)")                     â”‚
 â”‚    401 +             for j, phrase_span in enumerate(phrase_list):                                     â”‚
 â”‚    402                   # å¥ã®æ©Ÿèƒ½ã«é–¢ã™ã‚‹ç°¡å˜ãªèª¬æ˜ã‚’è¿½åŠ                                             â”‚
 â”‚    403                   phrase_function = ""                                                          â”‚
 â”‚    404                   if phrase_type == "åè©å¥ (NP)":                                              â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ render_phrase_structure_tabã®ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã‚Œã§ã€ãƒ•ã‚§ãƒ¼ã‚º2ã®ã€Œè¦–è¦šçš„ãªè¡¨ç¾ã®å¼·åŒ–ã€ãŒå®Œäº†ã—ã€å¥ã®åˆ†è§£ãŒã‚¤
  ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ„ãƒªãƒ¼ã§è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã¯ãšã§ã™ã€‚

  æ¬¡ã«ã€åŒã˜ããƒ•ã‚§ãƒ¼ã‚º2ã®ã‚¿ã‚¹ã‚¯ã§ã‚ã‚‹ã€Œæ–‡å‹åˆ¤å®š: ã‚ˆã‚Šè©³ç´°ãªSVOC/SVCã®åˆ†é¡ã€ã«é€²ã¿ã¾ã™ã€‚

  ç¾åœ¨ã®æ–‡å‹åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’ã•ã‚‰ã«å¼·åŒ–ã—ã€I consider him a genius. (SVOC) ã‚„ I regard him as a friend.
  (asã‚’ä¼´ã†SVOC) ã®ã‚ˆã†ã«ã€ç‰¹å®šã®å‹•è©ãŒä½œã‚‹å°‘ã—è¤‡é›‘ãªSVOC/SVCãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚æ­£ç¢ºã«åˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

   1. `determine_sentence_pattern` é–¢æ•°ã®ä¿®æ­£:
       * ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒªã‚¹ãƒˆã«ã€ç‰¹å®šã®å‹•è©ï¼ˆconsider, regardãªã©ï¼‰ã¨ã€ãã‚Œã«ç¶šãç‰¹å®šã®æ§‹é€ ï¼ˆä¾‹: as
         ã‚’ä¼´ã†å‰ç½®è©å¥ï¼‰ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã€ã‚ˆã‚Šè©³ç´°ãªSVOCåˆ¤å®šãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚
       * ã“ã‚Œã«ã‚ˆã‚Šã€æ–‡å‹åˆ¤å®šã®ç²¾åº¦ãŒã•ã‚‰ã«å‘ä¸Šã—ã€ã‚ˆã‚Šãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã®ç´°ã‹ã„æ–‡æ§‹é€ ã®ç†è§£ã‚’åŠ©ã‘ã¾ã™ã€‚

  ã“ã®å®Ÿè£…ã«ç€æ‰‹ã—ã¦ã‚ˆã‚ã—ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿæ‰¿çŸ¥ã„ãŸã—ã¾ã—ãŸã€‚ã§ã¯ã€ã€Œæ–‡å‹åˆ¤å®š:
  ã‚ˆã‚Šè©³ç´°ãªSVOC/SVCã®åˆ†é¡ã€ã®å®Ÿè£…ã‚’é–‹å§‹ã—ã¾ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

   1. `find_potential_elements` ã®æ‹¡å¼µ:
       * I regard him as a friend. ã®ã‚ˆã†ãªæ§‹æ–‡ã§ã¯ã€è£œèª(a friend)ãŒå‰ç½®è©å¥(as a
         friend)ã®ä¸­ã«ã‚ã‚Šã¾ã™ã€‚ç¾åœ¨ã®ãƒ­ã‚¸ãƒƒã‚¯ã§ã¯ã€ã“ã®ã‚ˆã†ãªè£œèªã‚’ç›´æ¥è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚
       * ãã“ã§ã€find_potential_elementsé–¢æ•°ã‚’ä¿®æ­£ã—ã€å‹•è©ã®å¾Œã«ç¶šãå‰ç½®è©å¥ã®ä¸­ã«è£œèªå€™è£œï¼ˆpobjï¼‰ãŒã‚ã‚‹å ´åˆã€ãã‚Œ
         ã‚’è£œèªã¨ã—ã¦èªè­˜ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ç‰¹ã«ã€asã®ã‚ˆã†ãªç‰¹å®šã®æ„å‘³ã‚’æŒã¤å‰ç½®è©ã‚’è€ƒæ…®ã—ã¾ã™ã€‚

   2. `determine_sentence_pattern` ã®ä¿®æ­£:
       * find_potential_elementsã§å¾—ã‚‰ã‚ŒãŸæ–°ã—ã„è£œèªã®æƒ…å ±ã‚’ä½¿ã„ã€determine_sentence_patterné–¢æ•°å†…ã®SVOCåˆ¤å®šãƒ­ã‚¸ãƒƒ
         ã‚¯ã‚’å¼·åŒ–ã—ã¾ã™ã€‚
       * considerã®ã‚ˆã†ãªå‹•è©ã¨ã€asã‚’ä¼´ã†å‹•è©ã®ä¸¡æ–¹ã®ã‚±ãƒ¼ã‚¹ã‚’ã‚«ãƒãƒ¼ã™ã‚‹ã€ã‚ˆã‚Šç²¾ç·»ãªSVOCãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚

  ã¾ãšã¯ã€find_potential_elementsé–¢æ•°ã‹ã‚‰ä¿®æ­£ã—ã¾ã™ã€‚æ‰¿çŸ¥ã„ãŸã—ã¾ã—ãŸã€‚ã¾ãšã€find_potential_elementsé–¢æ•°ã‚’ä¿®æ­£ã—
  ã€I regard him as a friendã®ã‚ˆã†ãªæ§‹æ–‡ã§ã€asã«ç¶šãç›®çš„èªã‚’è£œèªã¨ã—ã¦æ­£ã—ãèªè­˜ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

  å…·ä½“çš„ã«ã¯ã€ç›´æ¥ç›®çš„èª(dobj)ã®å­è¦ç´ ã«asã¨ã„ã†å‰ç½®è©ãŒã‚ã‚‹å ´åˆã€ãã®å‰ç½®è©ã®ç›®çš„èª(pobj)ã‚’æ–‡ã®è£œèª(complement)
  ã¨ã—ã¦ç‰¹å®šã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def find_potential_elements(do... => def find_potential_elements(do...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    Error: Failed to edit, could not find the string to replace.                                        â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ replaceæ“ä½œãŒå¤±æ•—ã—ã¾ã—ãŸã€‚ã“ã‚Œã¯ã€old_stringãŒãƒ•ã‚¡ã‚¤ãƒ«å†…ã§è¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚å‰å›ã®å¤‰æ›´ãŒå®Œå…¨ã«
  é©ç”¨ã•ã‚Œãªã‹ã£ãŸã‹ã€ã‚ã‚‹ã„ã¯å¾®å¦™ãªé•ã„ãŒç”Ÿã˜ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

  ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã€ã¾ãšspacy_app/app.pyã®ç¾åœ¨ã®å…¨å†…å®¹ã‚’å†åº¦èª­ã¿è¾¼ã¿ã€æœ€æ–°ã®çŠ¶æ…‹ã‚’æŠŠæ¡ã—ã¾ã™ã€‚ãã®å¾Œã€æ”¹ã‚
  ã¦find_potential_elementsé–¢æ•°ã‚’ä¿®æ­£ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  ReadFile spacy_app\app.py  â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’å†åº¦èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚ã©ã†ã‚„ã‚‰å‰å›ã® replace æ“ä½œã§ã€render_phrase_structure_tab
  ã®å†…å®¹ãŒæ„å›³ã›ãšé‡è¤‡ã—ã¦æ›¸ãè¾¼ã¾ã‚Œã¦ã—ã¾ã£ãŸã‚ˆã†ã§ã™ã€‚

  ã¾ãšã€ã“ã®é‡è¤‡ã—ã¦ã„ã‚‹éƒ¨åˆ†ã‚’ä¿®æ­£ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£å¸¸ãªçŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€render_phrase_structure_tab
  ã®é‡è¤‡ã—ã¦ã„ã‚‹å®šç¾©ã‚’å‰Šé™¤ã—ã€ä¸€ã¤ã ã‘ã®æ­£ã—ã„å®šç¾©ã‚’æ®‹ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def render_phrase_structure_ta... => def render_phrase_structure_ta...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    352       phrase_tabs = st.tabs(list(phrases.keys()))                                               â”‚
 â”‚    353                                                                                                 â”‚
 â”‚    354       # ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®HTMLã‚’èª­ã¿è¾¼ã‚€                                                  â”‚
 â”‚    355 +     try:                                                                                      â”‚
 â”‚    356           with open("spacy_app/components/interactive_tree.html", "r", encoding="utf-8") as f:  â”‚
 â”‚    357               interactive_tree_html = f.read()                                                  â”‚
 â”‚    358 +     except FileNotFoundError:                                                                 â”‚
 â”‚    359 +         st.error(                                                                             â”‚
 â”‚        "interactive_tree.htmlãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ãé…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„  â”‚
 â”‚        ã€‚")                                                                                            â”‚
 â”‚    360 +         return                                                                                â”‚
 â”‚    361                                                                                                 â”‚
 â”‚    362       for i, (phrase_type, phrase_list) in enumerate(phrases.items()):                          â”‚
 â”‚    363           with phrase_tabs[i]:                                                                  â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚    378                           st.markdown(f"**ğŸ’¡ æ©Ÿèƒ½:** {phrase_function}")                        â”‚
 â”‚    379                           root_token = phrase_span.root                                         â”‚
 â”‚    380                           tree_data = generate_phrase_tree_json(root_token)                     â”‚
 â”‚    381 +                         # st.json(tree_data) # ãƒ‡ãƒãƒƒã‚°ç”¨ã«JSONã‚’è¡¨ç¤º                         â”‚
 â”‚    382                           components.html(interactive_tree_html, height=400, scrolling=True)    â”‚
 â”‚    378 -                         st.session_state[f'tree_data_{i}_{j}'] = tree_data #                  â”‚
 â”‚        JSã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ãƒˆãƒªãƒƒã‚¯                                                                        â”‚
 â”‚    379 -                         # This is a trick to pass data to the component after it has been     â”‚
 â”‚        rendered.                                                                                       â”‚
 â”‚    380 -                         # A better approach would be to use a proper Streamlit custom         â”‚
 â”‚        component with a dedicated API.                                                                 â”‚
 â”‚    383 +                         # JSã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒã‚¹ãƒˆ                        â”‚
 â”‚    384 +                         # ã“ã®æ–¹æ³•ã¯ç†æƒ³çš„ã§ã¯ãªã„ãŒã€Streamlitã®åˆ¶ç´„ä¸‹ã§ã®å›é¿ç­–             â”‚
 â”‚    385                           st.components.v1.html(f'''                                            â”‚
 â”‚    386                               <script>                                                          â”‚
 â”‚    387 +                             (function() {{                                                    â”‚
 â”‚    388 +                                 const vscode = acquireVsCodeApi();                            â”‚
 â”‚    389 +                                 const data = {tree_data};                                     â”‚
 â”‚    390                                   window.parent.postMessage({{                                  â”‚
 â”‚    384 -                                     type: "streamlit:render",                                 â”‚
 â”‚    385 -                                     args: {{ treeData: {st.session_state[f'tree_data_{i}_{j}  â”‚
 â”‚        ']} }}                                                                                          â”‚
 â”‚    386 -                                 }}, "*");                                                     â”‚
 â”‚    391 +                                     type: 'streamlit:render',                                 â”‚
 â”‚    392 +                                     args: {{ treeData: data }}                                â”‚
 â”‚    393 +                                 }}, '*');                                                     â”‚
 â”‚    394 +                             }})();                                                            â”‚
 â”‚    395                               </script>                                                         â”‚
 â”‚    396                           ''', height=0)                                                        â”‚
 â”‚    389 -                                                                                               â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚    397               else:                                                                             â”‚
 â”‚    398                   st.markdown(f"ã“ã®æ–‡ã§ã¯ **{phrase_type}** ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚")         â”‚
 â”‚    399                                                                                                 â”‚
 â”‚    393 -     phrases = find_phrases(elements.doc)                                                      â”‚
 â”‚    394 -                                                                                               â”‚
 â”‚    395 -     phrase_tabs = st.tabs(list(phrases.keys()))                                               â”‚
 â”‚    396 -                                                                                               â”‚
 â”‚    397 -     for i, (phrase_type, phrase_list) in enumerate(phrases.items()):                          â”‚
 â”‚    398 -         with phrase_tabs[i]:                                                                  â”‚
 â”‚    399 -             if phrase_list:                                                                   â”‚
 â”‚    400 -                 st.markdown(f"#### {phrase_type} ({len(phrase_list)}å€‹æ¤œå‡º)")                 â”‚
 â”‚    401 -                 for j, phrase_span in enumerate(phrase_list):                                 â”‚
 â”‚    402 -                     # å¥ã®æ©Ÿèƒ½ã«é–¢ã™ã‚‹ç°¡å˜ãªèª¬æ˜ã‚’è¿½åŠ                                         â”‚
 â”‚    403 -                     phrase_function = ""                                                      â”‚
 â”‚    404 -                     if phrase_type == "åè©å¥ (NP)":                                          â”‚
 â”‚    405 -                         phrase_function = "æ–‡ã®ä¸»èªã€ç›®çš„èªã€è£œèªãªã©ã«ãªã‚Šã¾ã™ã€‚"            â”‚
 â”‚    406 -                     elif phrase_type == "å‰ç½®è©å¥ (PP)":                                      â”‚
 â”‚    407 -                         phrase_function =                                                     â”‚
 â”‚        "å ´æ‰€ã€æ™‚é–“ã€æ–¹æ³•ãªã©ã‚’è¡¨ã—ã€å½¢å®¹è©ã‚„å‰¯è©ã®ã‚ˆã†ã«åƒãã¾ã™ã€‚"                                    â”‚
 â”‚    408 -                     elif phrase_type == "å½¢å®¹è©å¥ (AdjP)":                                    â”‚
 â”‚    409 -                         phrase_function = "åè©ã‚’ä¿®é£¾ï¼ˆèª¬æ˜ï¼‰ã—ã¾ã™ã€‚"                        â”‚
 â”‚    410 -                     elif phrase_type == "å‰¯è©å¥ (AdvP)":                                      â”‚
 â”‚    411 -                         phrase_function = "å‹•è©ã€å½¢å®¹è©ã€æ–‡å…¨ä½“ã‚’ä¿®é£¾ï¼ˆèª¬æ˜ï¼‰ã—ã¾ã™ã€‚"        â”‚
 â”‚    412 -                                                                                               â”‚
 â”‚    413 -                     with st.expander(f"{j+1}. `{phrase_span.text}`"):                         â”‚
 â”‚    414 -                         st.markdown(f"**ğŸ’¡ æ©Ÿèƒ½:** {phrase_function}")                        â”‚
 â”‚    415 -                         # å¥ã®ãƒ«ãƒ¼ãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¦‹ã¤ã‘ã¦ãƒ„ãƒªãƒ¼ã‚’ç”Ÿæˆ                            â”‚
 â”‚    416 -                         root_token = phrase_span.root                                         â”‚
 â”‚    417 -                         st.markdown("**æ§‹é€ ãƒ„ãƒªãƒ¼:**")                                        â”‚
 â”‚    418 -                         st.markdown(f'<ul class="tree">                                       â”‚
 â”‚        {generate_phrase_tree_html(root_token)}</ul>', unsafe_allow_html=True)                          â”‚
 â”‚    419 -             else:                                                                             â”‚
 â”‚    420 -                 st.markdown(f"ã“ã®æ–‡ã§ã¯ **{phrase_type}** ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚")         â”‚
 â”‚    421 -                                                                                               â”‚
 â”‚    400   def find_clause_elements(doc):                                                                â”‚
 â”‚    401       """æ–‡ã‹ã‚‰ä¸»ç¯€ã¨å¾“å±ç¯€ã‚’ç‰¹å®šã—ã€å¾“å±ç¯€ã‚’åˆ†é¡ã™ã‚‹"""                                        â”‚
 â”‚    402       clauses = []                                                                              â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®å¾©ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã“ã‚Œã§ app.py ãŒæ­£å¸¸ãªçŠ¶æ…‹ã«æˆ»ã‚Šã¾ã—ãŸã€‚

  æ”¹ã‚ã¦ã€ã€Œæ–‡å‹åˆ¤å®š: ã‚ˆã‚Šè©³ç´°ãªSVOC/SVCã®åˆ†é¡ã€ã®å®Ÿè£…ã‚’å†é–‹ã—ã¾ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

   1. `find_potential_elements` ã®æ‹¡å¼µ:
       * I regard him as a friend. ã®ã‚ˆã†ãªæ§‹æ–‡ã§ã€as
         ã«ç¶šãç›®çš„èªã‚’è£œèªã¨ã—ã¦æ­£ã—ãèªè­˜ã§ãã‚‹ã‚ˆã†ã«ã€find_potential_elementsé–¢æ•°ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

   2. `determine_sentence_pattern` ã®ä¿®æ­£:
       * ä¸Šè¨˜ã§å¾—ã‚‰ã‚ŒãŸæ–°ã—ã„è£œèªã®æƒ…å ±ã‚’ä½¿ã„ã€determine_sentence_patterné–¢æ•°å†…ã®SVOCåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’å¼·åŒ–ã—ã¾ã™ã€‚

  ã¾ãšã¯ã€find_potential_elementsé–¢æ•°ã‹ã‚‰ä¿®æ­£ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def find_potential_elements(do... => def find_potential_elements(do...       â”‚
 â”‚                                                                                                        â”‚
 â”‚     89   # Complement                                                                                  â”‚
 â”‚     90   elements['complement'] = next((c for c in main_verb.children if c.dep_ in ["attr", "acomp",   â”‚
 â”‚          "oprd", "ccomp", "xcomp", "acl"]), None)                                                      â”‚
 â”‚     91                                                                                                 â”‚
 â”‚     92 - # Special SVOC cases where complement is a child of dobj (e.g., "made me happy", "saw him     â”‚
 â”‚        leaving")                                                                                       â”‚
 â”‚     92 + # Special SVOC cases where complement is a child of dobj (e.g., "made me happy", "regard him  â”‚
 â”‚        as a friend")                                                                                   â”‚
 â”‚     93   if elements['dobj'] and not elements['complement']:                                           â”‚
 â”‚     94 +     # Case 1: "made me happy" (acomp, oprd, acl)                                              â”‚
 â”‚     95       elements['complement'] = next((c for c in elements['dobj'].children if c.dep_ in [        â”‚
 â”‚          "acomp", "oprd", "acl"]), None)                                                               â”‚
 â”‚     96                                                                                                 â”‚
 â”‚     97 +     # Case 2: "regard him as a friend" (prep 'as')                                            â”‚
 â”‚     98 +     if not elements['complement']:                                                            â”‚
 â”‚     99 +         prep_as = next((c for c in main_verb.children if c.dep_ == "prep" and c.text.lower()  â”‚
 â”‚        == "as" and c.head == elements['dobj']), None)                                                  â”‚
 â”‚    100 +         if prep_as:                                                                           â”‚
 â”‚    101 +             elements['complement'] = next((pobj for pobj in prep_as.children if pobj.dep_ ==  â”‚
 â”‚        "pobj"), None)                                                                                  â”‚
 â”‚    102 +                                                                                               â”‚
 â”‚    103   # Special SVOC cases where dobj is nsubj of xcomp/ccomp (e.g., "want him to go")              â”‚
 â”‚    104   if not elements['dobj'] and elements['complement'] and elements['complement'].dep_ in [       â”‚
 â”‚          "ccomp", "xcomp"]:                                                                            â”‚
 â”‚    105       elements['dobj'] = next((gc for gc in elements['complement'].children if gc.dep_ ==       â”‚
 â”‚          "nsubj"), None)                                                                               â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ find_potential_elementsé–¢æ•°ã®ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  æ¬¡ã«ã€ã“ã®ä¿®æ­£ã§å¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸæ–°ã—ã„è£œèªã®æƒ…å ±ã‚’æ´»ç”¨ã—ã¦ã€determine_sentence_patterné–¢æ•°å†…ã®SVOCåˆ¤å®šãƒ­ã‚¸
  ãƒƒã‚¯ã‚’å¼·åŒ–ã—ã¾ã™ã€‚

  å…·ä½“çš„ã«ã¯ã€I consider him a genius.ã®ã‚ˆã†ãªã€ç›®çš„èªã®ã™ãå¾Œã«è£œèªï¼ˆåè©ï¼‰ãŒæ¥ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã€I regard him as a
  friend.ã®ã‚ˆã†ãªasã‚’ä¼´ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸¡æ–¹ã‚’SVOCã¨ã—ã¦åˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ã€ãƒ‘ã‚¿ãƒ¼ãƒ³å®šç¾©ã‚’ä¿®æ­£ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def determine_sentence_pattern... => def determine_sentence_pattern...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    120   ("å€’ç½®æ§‹æ–‡", lambda: s and v and aux and aux.i < s.i),                                        â”‚
 â”‚    121   # thereæ§‹æ–‡ã‚’æœ€å„ªå…ˆã§ãƒã‚§ãƒƒã‚¯                                                                 â”‚
 â”‚    122   ("SV (ç¬¬1æ–‡å‹) - There is/are æ§‹æ–‡", lambda: v and any(t.dep_ == "expl" and t.text.lower()    â”‚
 â”‚          == "there" for t in v.children)),                                                             â”‚
 â”‚    123 - # SVOC: oprdã‚’æŒã¤ã‹ã€acompã‚’æŒã¤ã‹ã€xcomp ã‚’æŒã¤è¤‡é›‘ãªã‚±ãƒ¼ã‚¹                                 â”‚
 â”‚    124 - ("SVOC (ç¬¬5æ–‡å‹)", lambda: s and v and o1 and c and (c.dep_ == "oprd" or c.dep_ == "acomp"    â”‚
 â”‚        or (c.dep_ in ["xcomp", "ccomp"] and o1 == next((gc for gc in c.children if gc.dep_ == "nsubj"  â”‚
 â”‚        ), None)))),                                                                                    â”‚
 â”‚    123 + # SVOC: oprd, acomp,                                                                          â”‚
 â”‚        xcompã‚’æŒã¤ã‹ã€ç‰¹å®šã®å‹•è©(considerç­‰)ã§ç›®çš„èªã®å¾Œã«åè©/å½¢å®¹è©ãŒç¶šãã‹ã€asã‚’ä¼´ã†å ´åˆ            â”‚
 â”‚    124 + ("SVOC (ç¬¬5æ–‡å‹)", lambda: s and v and o1 and c and (                                         â”‚
 â”‚    125 +     c.dep_ in ["oprd", "acomp"] or                                                            â”‚
 â”‚    126 +     (c.dep_ in ["xcomp", "ccomp"] and o1 == next((gc for gc in c.children if gc.dep_ ==       â”‚
 â”‚        "nsubj"), None)) or                                                                             â”‚
 â”‚    127 +     (v.lemma_ in ["consider", "call", "name", "elect", "appoint"] and c.head == o1) or        â”‚
 â”‚    128 +     (c.head.dep_ == "prep" and c.head.text.lower() == "as" and c.head.head == o1)             â”‚
 â”‚    129 + )),                                                                                           â”‚
 â”‚    130   ("SVOO (ç¬¬4æ–‡å‹)", lambda: s and v and o1 and o2),                                            â”‚
 â”‚    131   ("SVC (ç¬¬2æ–‡å‹)", lambda: s and v and c and v.lemma_ in ["be", "become", "seem", "look",      â”‚
 â”‚          "feel", "sound", "taste", "smell", "get", "grow", "turn", "remain", "stay"]),                 â”‚
 â”‚    132   ("SVO (ç¬¬3æ–‡å‹)", lambda: s and v and o1),                                                    â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ ã“ã‚Œã§ã€ã€Œæ–‡å‹åˆ¤å®š: ã‚ˆã‚Šè©³ç´°ãªSVOC/SVCã®åˆ†é¡ã€ã®å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  ä»¥ä¸Šã§ã€ææ¡ˆã•ã‚Œã¦ã„ãŸæ”¹å–„è¨ˆç”»ã®ãƒ•ã‚§ãƒ¼ã‚º2ã€Œè¦–è¦šçš„è¡¨ç¾ã¨æ·±ã„ç†è§£ã®ä¿ƒé€²ã€ã®ä¸»è¦ãªã‚¿ã‚¹ã‚¯ã¯å®Œäº†ã¨ãªã‚Šã¾ã™ã€‚

   * ã‚ˆã‚Šå¤šæ§˜ãªå¥ã®åˆ†è§£: å®Œäº†
   * è¦–è¦šçš„ãªè¡¨ç¾ã®å¼·åŒ–ï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ„ãƒªãƒ¼ï¼‰: å®Œäº†
   * ã‚ˆã‚Šè©³ç´°ãªSVOC/SVCã®åˆ†é¡: å®Œäº†

  æ¬¡ã«ã€æœ€çµ‚ãƒ•ã‚§ãƒ¼ã‚ºã§ã‚ã‚‹ãƒ•ã‚§ãƒ¼ã‚º3ã€Œé«˜åº¦ãªæ–‡æ³•ç¾è±¡ã¨å¿œç”¨ã€ã«é€²ã¿ã¾ã™ã€‚

  æœ€åˆã®ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ã€ã€Œç¯€ã®æ§‹é€ : éå®šå½¢ç¯€ (Non-finite Clauses) 
  ã®è­˜åˆ¥ã€ã«å–ã‚Šçµ„ã¿ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚ˆã‚Šé«˜åº¦ãªæ–‡æ³•ç†è§£ã«ä¸å¯æ¬ ãªè¦ç´ ã§ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

   1. éå®šå½¢ç¯€ã®è­˜åˆ¥ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ :
       * find_clause_elementsé–¢æ•°ã‚’æ‹¡å¼µã—ã€ç¾åœ¨æ¤œå‡ºã—ã¦ã„ã‚‹å®šå½¢ç¯€ï¼ˆä¸»èªã¨å®šå½¢å‹•è©ã‚’æŒã¤ç¯€ï¼‰ã«åŠ ãˆã€ä¸å®šè©å¥ã€å‹•å
         è©å¥ã€åˆ†è©å¥ã¨ã„ã£ãŸéå®šå½¢ç¯€ã‚’è­˜åˆ¥ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¾ã™ã€‚
       * spaCyã®ä¾å­˜é–¢ä¿‚ï¼ˆxcomp, csubj,
         aclãªã©ï¼‰ã¨å“è©æƒ…å ±ï¼ˆVERBã ãŒå®šå½¢ã§ãªã„ï¼‰ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ã“ã‚Œã‚‰ã®éå®šå½¢ç¯€ã‚’æ¤œå‡ºã—ã¾ã™ã€‚

   2. UIã®æ›´æ–°:
       * render_clause_structure_tabé–¢æ•°ã‚’ä¿®æ­£ã—ã€æ¤œå‡ºã—ãŸéå®šå½¢ç¯€ã‚’ã€Œå¾“å±ç¯€ï¼ˆä¸å®šè©å¥ï¼‰ã€ã‚„ã€Œå¾“å±ç¯€ï¼ˆåˆ†è©å¥ï¼‰ã€ã®
         ã‚ˆã†ã«ã€åˆ†é¡ã—ã¦è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
       * éå®šå½¢ç¯€ã«ã¯æ˜ç¤ºçš„ãªä¸»èªãŒãªã„å ´åˆãŒå¤šã„ãŸã‚ã€ã€Œæ„å‘³ä¸Šã®ä¸»èªã€ã‚’ç‰¹å®šã—ã€è§£èª¬ã«åŠ ãˆã‚‹ã“ã¨ã‚‚æ¤œè¨ã—ã¾ã™ã€‚

  ã“ã®å®Ÿè£…ã«ç€æ‰‹ã—ã¦ã‚ˆã‚ã—ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚  > ãƒ•ã‚§ãƒ¼ã‚º3ã€Œé«˜åº¦ãªæ–‡æ³•ç¾è±¡ã¨å¿œç”¨ã€ã«é€²ã¿ã¾ã™  â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

âœ¦ æ‰¿çŸ¥ã„ãŸã—ã¾ã—ãŸã€‚æœ€çµ‚ãƒ•ã‚§ãƒ¼ã‚º3ã€Œé«˜åº¦ãªæ–‡æ³•ç¾è±¡ã¨å¿œç”¨ã€ã‚’é–‹å§‹ã—ã¾ã™ã€‚

  æœ€åˆã®ã‚¿ã‚¹ã‚¯ã¯ã€ã”ææ¡ˆã®é€šã‚Šã€Œéå®šå½¢ç¯€ (Non-finite Clauses) 
  ã®è­˜åˆ¥ã€ã§ã™ã€‚ä¸å®šè©å¥ã€å‹•åè©å¥ã€åˆ†è©å¥ã‚’æ¤œå‡ºã—ã€æ–‡ã®æ§‹é€ åˆ†æã‚’ã•ã‚‰ã«æ·±åŒ–ã•ã›ã¾ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

   1. `find_clause_elements` é–¢æ•°ã®æ‹¡å¼µ:
       * ä¸å®šè©ï¼ˆto + å‹•è©ï¼‰ã€å‹•åè©ï¼ˆå‹•è©ã®-ingå½¢ãŒåè©ã¨ã—ã¦æ©Ÿèƒ½ï¼‰ã€åˆ†è©ï¼ˆ-ingå½¢ã‚„éå»åˆ†è©å½¢ãŒå½¢å®¹è©ã¨ã—ã¦æ©Ÿèƒ½ï¼‰
         ã‚’æ ¸ã¨ã™ã‚‹ç¯€ï¼ˆå¥ï¼‰ã‚’è­˜åˆ¥ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¾ã™ã€‚
       * spaCyã®ä¾å­˜é–¢ä¿‚ï¼ˆxcomp, acl, csubj,
         pobjãªã©ï¼‰ã¨å“è©ã‚¿ã‚°ï¼ˆVERBï¼‰ã‚’çµ„ã¿åˆã‚ã›ã€ã“ã‚Œã‚‰ã®éå®šå½¢ç¯€ã‚’æ¤œå‡ºã—ã¾ã™ã€‚
       * æ¤œå‡ºã—ãŸç¯€ã«ã¯ã€ã€Œä¸å®šè©å¥ã€ã€Œå‹•åè©å¥ã€ã€Œåˆ†è©å¥ã€ã¨ã„ã£ãŸæ–°ã—ã„åˆ†é¡ã‚’ä¸ãˆã¾ã™ã€‚

   2. UI (`render_clause_structure_tab`) ã®æ›´æ–°:
       * æ–°ã—ã„åˆ†é¡ã‚’UIã«åæ˜ ã•ã›ã€ä¾‹ãˆã°ã€Œå¾“å±ç¯€ï¼ˆåˆ†è©å¥ï¼‰ã€ã®ã‚ˆã†ã«è¡¨ç¤ºã—ã¾ã™ã€‚
       * ãã‚Œãã‚Œã®éå®šå½¢ç¯€ã®æ©Ÿèƒ½ï¼ˆä¾‹ï¼šã€Œåè©ã‚’ä¿®é£¾ã—ã¦ã„ã¾ã™ã€ï¼‰ã«ã¤ã„ã¦ã®è§£èª¬ã‚’è¿½åŠ ã—ã¾ã™ã€‚

  ã¾ãšã¯ã€ä¸­æ ¸ãƒ­ã‚¸ãƒƒã‚¯ã§ã‚ã‚‹ find_clause_elements é–¢æ•°ã‚’æ‹¡å¼µã™ã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def find_clause_elements(doc):... => def find_clause_elements(doc):...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    ... first 60 lines hidden ...                                                                       â”‚
 â”‚    448 +             detailed_type = ""                                                                â”‚
 â”‚    449 +             # å…·ä½“çš„ãªã‚¿ã‚¤ãƒ—ã‚’åˆ¤åˆ¥                                                            â”‚
 â”‚    450 +             if token.dep_ == 'xcomp':                                                         â”‚
 â”‚    451 +                 is_infinitive = any(c.dep_ == 'aux' and c.text.lower() == 'to' for c in       â”‚
 â”‚        token.children)                                                                                 â”‚
 â”‚    452 +                 detailed_type = "ä¸å®šè©å¥" if is_infinitive else "åˆ†è©å¥"                     â”‚
 â”‚    453 +             elif token.tag_ == 'VBG': # Gerund or Participle                                  â”‚
 â”‚    454 +                 detailed_type = "å‹•åè©å¥" if token.dep_ in ['csubj', 'pobj'] else "åˆ†è©å¥"   â”‚
 â”‚    455 +             elif token.tag_ == 'VBN': # Past participle                                       â”‚
 â”‚    456 +                 detailed_type = "åˆ†è©å¥"                                                      â”‚
 â”‚    457 +             elif any(c.dep_ == 'aux' and c.text.lower() == 'to' for c in token.children):     â”‚
 â”‚    458 +                  detailed_type = "ä¸å®šè©å¥"                                                   â”‚
 â”‚    459                                                                                                 â”‚
 â”‚    441 -             # é–¢ä¿‚ä»£åè©ç¯€ã®ä¸»èªãŒé–¢ä¿‚ä»£åè©è‡ªèº«ã®å ´åˆ (who, which)                           â”‚
 â”‚    442 -             if not subject and token.dep_ in ["relcl", "acl"] and token.pos_ == "PRON":       â”‚
 â”‚    443 -                 subject = token                                                               â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚    460 +             if detailed_type:                                                                 â”‚
 â”‚    461 +                 clause_info = {"type": "éå®šå½¢ç¯€", "detailed_type": detailed_type, "verb":    â”‚
 â”‚        token}                                                                                          â”‚
 â”‚    462                                                                                                 â”‚
 â”‚    445 -             # åˆ†è©æ§‹æ–‡(acl)ãªã©ã§ã€æ„å‘³ä¸Šã®ä¸»èªãŒç¯€ã®å¤–éƒ¨ã«ã‚ã‚‹å ´åˆ                           â”‚
 â”‚    446 -             if not subject and token.dep_ == "acl":                                           â”‚
 â”‚    447 -                 subject = token.head # ä¿®é£¾ã•ã‚Œã‚‹åè©ã‚’ä¸»èªã¨ã¿ãªã™                           â”‚
 â”‚    448 -                                                                                               â”‚
 â”‚    449 -             # å°å…¥èªã®ç‰¹å®š                                                                    â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚    463 +         if clause_info:                                                                       â”‚
 â”‚    464 +             verb = clause_info['verb']                                                        â”‚
 â”‚    465 +             subject = next((c for c in verb.children if c.dep_ in ["nsubj", "nsubjpass"]),    â”‚
 â”‚        None)                                                                                           â”‚
 â”‚    466 +             omitted_introducer_text = None                                                    â”‚
 â”‚    467               introducer = None                                                                 â”‚
 â”‚    451 -             if token.dep_ in ["advcl", "ccomp", "csubj", "cobj"]: # markã‚’æŒã¤ç¯€              â”‚
 â”‚    452 -                 introducer = next((c for c in token.children if c.dep_ == "mark"), None)      â”‚
 â”‚    453 -             elif token.dep_ in ["relcl", "acl"]: # é–¢ä¿‚è©ã‚’æŒã¤ç¯€                             â”‚
 â”‚    454 -                 # ä¸»èªãŒé–¢ä¿‚ä»£åè©ã®å ´åˆ                                                      â”‚
 â”‚    455 -                 if subject and subject.i == token.i and subject.pos_ == "PRON":               â”‚
 â”‚    456 -                     introducer = subject                                                      â”‚
 â”‚    457 -                 else: # ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ãªã©                                                â”‚
 â”‚    458 -                     introducer = next((c for c in token.children if c.dep_ in ["nsubj",       â”‚
 â”‚        "dobj"] and c.pos_ == "PRON"), None)                                                            â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚    468                                                                                                 â”‚
 â”‚    460 -                 # é–¢ä¿‚ä»£åè©(that)ã®çœç•¥ã‚’æ¤œå‡º                                                â”‚
 â”‚    461 -                 if not introducer and subject:                                                â”‚
 â”‚    462 -                     # ç¯€å†…ã«dobjãŒãªã„å ´åˆã€çœç•¥ã®å¯èƒ½æ€§ãŒé«˜ã„                                â”‚
 â”‚    463 -                     if not any(c.dep_ == "dobj" for c in token.children):                     â”‚
 â”‚    464 -                         omitted_introducer_text = "that"                                      â”‚
 â”‚    469 +             # ä¸»èªã®ç‰¹å®šãƒ­ã‚¸ãƒƒã‚¯ (éå®šå½¢ç¯€ã‚‚è€ƒæ…®)                                             â”‚
 â”‚    470 +             if not subject:                                                                   â”‚
 â”‚    471 +                 if verb.dep_ in ["relcl", "acl"] and verb.pos_ == "PRON": subject = verb #    â”‚
 â”‚        who, which                                                                                      â”‚
 â”‚    472 +                 elif verb.dep_ == "acl": subject = verb.head # åˆ†è©ãŒä¿®é£¾ã™ã‚‹åè©             â”‚
 â”‚    473 +                 elif verb.dep_ == "xcomp": subject = next((s for s in verb.head.children if   â”‚
 â”‚        s.dep_ == 'nsubj'), None) # I want to go -> I                                                   â”‚
 â”‚    474                                                                                                 â”‚
 â”‚    466 -             #                                                                                 â”‚
 â”‚        å°å…¥èªãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€ç¯€ã®æœ€åˆã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒæ¥ç¶šè©ã‚„é–¢ä¿‚ä»£åè©ã§ã‚ã‚Œã°ãã‚Œã‚’å°å…¥èªã¨ã™ã‚‹      â”‚
 â”‚    467 -             if not introducer and token.sent.start == token.i and token.pos_ in ["SCONJ",     â”‚
 â”‚        "PRON"]:                                                                                        â”‚
 â”‚    468 -                 introducer = token                                                            â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚    475 +             # å°å…¥èªã®ç‰¹å®šãƒ­ã‚¸ãƒƒã‚¯                                                            â”‚
 â”‚    476 +             if clause_info['type'] == 'å¾“å±ç¯€':                                               â”‚
 â”‚    477 +                 if verb.dep_ in ["advcl", "ccomp"]: introducer = next((c for c in             â”‚
 â”‚        verb.children if c.dep_ == "mark"), None)                                                       â”‚
 â”‚    478 +                 elif verb.dep_ == "relcl":                                                    â”‚
 â”‚    479 +                     introducer = next((c for c in verb.children if c.dep_ in ["nsubj",        â”‚
 â”‚        "dobj"] and c.pos_ == "PRON"), subject if subject and subject.pos_ == "PRON" else None)         â”‚
 â”‚    480 +                     if not introducer and subject and not any(c.dep_ == "dobj" for c in       â”‚
 â”‚        verb.children): omitted_introducer_text = "that"                                                â”‚
 â”‚    481 +             elif clause_info['detailed_type'] == 'ä¸å®šè©å¥':                                  â”‚
 â”‚    482 +                 introducer = next((c for c in verb.children if c.dep_ == 'aux' and            â”‚
 â”‚        c.text.lower() == 'to'), None)                                                                  â”‚
 â”‚    483                                                                                                 â”‚
 â”‚    470 -             # ç¯€å…¨ä½“ã®spanã‚’å–å¾—                                                              â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚    484               clause_span = doc[min(t.i for t in verb.subtree):max(t.i for t in verb.subtree)   â”‚
 â”‚          + 1]                                                                                          â”‚
 â”‚    472 -             detailed_type = clause_type_map.get(token.dep_, "ä¸æ˜ãªç¯€")                       â”‚
 â”‚    473 -                                                                                               â”‚
 â”‚    474 -             clauses.append({                                                                  â”‚
 â”‚    475 -                 "type": "å¾“å±ç¯€",                                                             â”‚
 â”‚    476 -                 "detailed_type": detailed_type,                                               â”‚
 â”‚    477 -                 "verb": verb,                                                                 â”‚
 â”‚    478 -                 "subject": subject,                                                           â”‚
 â”‚    479 -                 "introducer": introducer,                                                     â”‚
 â”‚    480 -                 "span": clause_span,                                                          â”‚
 â”‚    481 -                 "omitted_introducer_text": omitted_introducer_text                            â”‚
 â”‚    485 +             clause_info.update({                                                              â”‚
 â”‚    486 +                 "subject": subject, "introducer": introducer, "span": clause_span,            â”‚
 â”‚        "omitted_introducer_text": omitted_introducer_text                                              â”‚
 â”‚    487               })                                                                                â”‚
 â”‚    488 +             clauses.append(clause_info)                                                       â”‚
 â”‚    489                                                                                                 â”‚
 â”‚    484 -     # é‡è¤‡ã‚„åŒ…å«é–¢ä¿‚ã«ã‚ã‚‹ç¯€ã‚’æ•´ç† (ä¾‹: aclãŒrelclå†…ã«å«ã¾ã‚Œã‚‹å ´åˆãªã©)                       â”‚
 â”‚    490 +     # é‡è¤‡å‰Šé™¤ã¨ã‚½ãƒ¼ãƒˆ                                                                        â”‚
 â”‚    491       unique_clauses = []                                                                       â”‚
 â”‚    492       sorted_clauses = sorted(clauses, key=lambda c: (c['span'].start, -len(c['span'])))        â”‚
 â”‚    493       for clause in sorted_clauses:                                                             â”‚
 â”‚    488 -         is_duplicate = False                                                                  â”‚
 â”‚    489 -         for uc in unique_clauses:                                                             â”‚
 â”‚    490 -             # åŒã˜spanã‚’æŒã¤ç¯€ã¯è¿½åŠ ã—ãªã„                                                    â”‚
 â”‚    491 -             if uc['span'] == clause['span']:                                                  â”‚
 â”‚    492 -                 is_duplicate = True                                                           â”‚
 â”‚    493 -                 break                                                                         â”‚
 â”‚    494 -             # ã‚ˆã‚Šå¤§ããªç¯€ã«å®Œå…¨ã«å«ã¾ã‚Œã‚‹ç¯€ã¯è¿½åŠ ã—ãªã„ (ãŸã ã—ä¸»ç¯€ã¨å¾“å±ç¯€ã®é–¢ä¿‚ã¯é™¤ã)     â”‚
 â”‚    495 -             if uc['span'].start <= clause['span'].start and uc['span'].end >= clause['span'   â”‚
 â”‚        ].end and uc['type'] == clause['type']:                                                         â”‚
 â”‚    496 -                  is_duplicate = True                                                          â”‚
 â”‚    497 -                  break                                                                        â”‚
 â”‚    494 +         is_duplicate = any(uc['span'] == clause['span'] or (uc['span'].start <= clause[       â”‚
 â”‚        'span'].start and uc['span'].end >= clause['span'].end and uc['type'] == clause['type']) for    â”‚
 â”‚        uc in unique_clauses)                                                                           â”‚
 â”‚    495           if not is_duplicate:                                                                  â”‚
 â”‚    496               unique_clauses.append(clause)                                                     â”‚
 â”‚    497                                                                                                 â”‚
 â”‚    501 -     # ç¯€ã®é–‹å§‹ä½ç½®ã§ã‚½ãƒ¼ãƒˆ                                                                    â”‚
 â”‚    498       unique_clauses.sort(key=lambda c: c['span'].start)                                        â”‚
 â”‚    499       return unique_clauses                                                                     â”‚
 â”‚    500                                                                                                 â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ find_clause_elementsé–¢æ•°ã®æ‹¡å¼µãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  æ¬¡ã«ã€ã“ã®æ–°ã—ã„éå®šå½¢ç¯€ã®åˆ†é¡ã‚’UIã«åæ˜ ã•ã›ã‚‹ãŸã‚ã€render_clause_highlighted_text ã¨
  render_clause_structure_tab ã®ä¸¡é–¢æ•°ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

   1. `render_clause_highlighted_text` ã®ä¿®æ­£:
       * éå®šå½¢ç¯€ï¼ˆä¸å®šè©å¥ã€å‹•åè©å¥ã€åˆ†è©å¥ï¼‰ç”¨ã«æ–°ã—ã„èƒŒæ™¯è‰²ã‚’å®šç¾©ã—ã¾ã™ã€‚
       * ç¯€ã®ã‚µãƒãƒªãƒ¼è¡¨ç¤ºã§ã€ä¾‹ãˆã°ã€Œéå®šå½¢ç¯€ï¼ˆä¸å®šè©å¥ï¼‰ã€ã®ã‚ˆã†ã«è¡¨ç¤ºã—ã€ãã®æ©Ÿèƒ½ã«é–¢ã™ã‚‹è§£èª¬ã‚’ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã§åŠ 
         ãˆã¾ã™ã€‚

   2. `render_clause_structure_tab` ã®ä¿®æ­£:
       * è©³ç´°è¡¨ç¤ºï¼ˆexpanderï¼‰ã®ã‚¿ã‚¤ãƒˆãƒ«ã¨è§£èª¬ã‚‚ã€éå®šå½¢ç¯€ã®åˆ†é¡ã«å¯¾å¿œã•ã›ã¾ã™ã€‚
       * éå®šå½¢ç¯€ã®å ´åˆã€ä¸»èªãŒæ˜ç¤ºã•ã‚Œãªã„ã“ã¨ãŒå¤šã„ãŸã‚ã€ã€Œæ„å‘³ä¸Šã®ä¸»èªã€ã‚’è¡¨ç¤ºã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¾ã™ã€‚ï¼ˆä¾‹ï¼š
         ã€Œã“ã®å‹•ä½œã‚’è¡Œã†ã®ã¯ I ã§ã™ã€ï¼‰

  ã¾ãšã¯ã€ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºã‚’æ‹…å½“ã™ã‚‹ render_clause_highlighted_text ã‹ã‚‰ä¿®æ­£ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def render_clause_highlighted_... => def render_clause_highlighted_...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    506   role_desc = {                                                                                 â”‚
 â”‚    507       "ä¸»èª": "ã“ã®ç¯€ã®å‹•ä½œã‚„çŠ¶æ…‹ã®ä¸»ä½“ã§ã™ã€‚",                                                 â”‚
 â”‚    508       "å‹•è©": "ã“ã®ç¯€ã®å‹•ä½œã‚„çŠ¶æ…‹ã‚’è¡¨ã—ã¾ã™ã€‚",                                                 â”‚
 â”‚    509 -     "å°å…¥èª": "ã“ã®ç¯€ã‚’å°ãæ¥ç¶šè©ã‚„é–¢ä¿‚è©ã§ã™ã€‚"                                              â”‚
 â”‚    509 +     "å°å…¥èª": "ã“ã®ç¯€ã‚’å°ãæ¥ç¶šè©ã‚„é–¢ä¿‚è©ã€ä¸å®šè©ã®toãªã©ã§ã™ã€‚"                              â”‚
 â”‚    510   }                                                                                             â”‚
 â”‚    511   clause_type_desc = {                                                                          â”‚
 â”‚    512       "ä¸»ç¯€": "æ–‡ã®æ ¸ã¨ãªã‚‹ä¸»è¦ãªéƒ¨åˆ†ã§ã™ã€‚",                                                   â”‚
 â”‚    513       "åè©ç¯€": "æ–‡ã®ä¸­ã§åè©ã¨åŒã˜åƒãï¼ˆä¸»èªã€ç›®çš„èªã€è£œèªï¼‰ã‚’ã—ã¾ã™ã€‚",                       â”‚
 â”‚    514       "å½¢å®¹è©ç¯€": "å…ˆè¡Œã™ã‚‹åè©ï¼ˆå…ˆè¡Œè©ï¼‰ã‚’è©³ã—ãèª¬æ˜ï¼ˆä¿®é£¾ï¼‰ã—ã¾ã™ã€‚",                         â”‚
 â”‚    515 -     "å‰¯è©ç¯€": "å‹•è©ã‚’ä¿®é£¾ã—ã€æ™‚ã€ç†ç”±ã€æ¡ä»¶ãªã©ã®è¿½åŠ æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚"                      â”‚
 â”‚    515 +     "å‰¯è©ç¯€": "å‹•è©ã‚’ä¿®é£¾ã—ã€æ™‚ã€ç†ç”±ã€æ¡ä»¶ãªã©ã®è¿½åŠ æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚",                     â”‚
 â”‚    516 +     "ä¸å®šè©å¥": "åè©ã€å½¢å®¹è©ã€å‰¯è©ãªã©ã€æ§˜ã€…ãªåƒãã‚’ã—ã¾ã™ã€‚to+å‹•è©ã®åŸå½¢ãŒåŸºæœ¬ã§ã™ã€‚",      â”‚
 â”‚    517 +     "å‹•åè©å¥": "åè©ã®åƒãã‚’ã—ã¾ã™ã€‚å‹•è©ã®-ingå½¢ãŒä½¿ã‚ã‚Œã¾ã™ã€‚",                             â”‚
 â”‚    518 +     "åˆ†è©å¥": "å½¢å®¹è©ã®ã‚ˆã†ã«åè©ã‚’ä¿®é£¾ã—ãŸã‚Šã€æ–‡ã®çŠ¶æ³ã‚’èª¬æ˜ã—ãŸã‚Šã—ã¾ã™ã€‚"                  â”‚
 â”‚    519   }                                                                                             â”‚
 â”‚    520 + clause_colors = {                                                                             â”‚
 â”‚    521 +     "ä¸»ç¯€": "#E0FFFF",                                                                        â”‚
 â”‚    522 +     "å¾“å±ç¯€": "#FFFACD",                                                                      â”‚
 â”‚    523 +     "éå®šå½¢ç¯€": "#F0FFF0"                                                                     â”‚
 â”‚    524 + }                                                                                             â”‚
 â”‚    525                                                                                                 â”‚
 â”‚    526   for clause in clauses:                                                                        â”‚
 â”‚    519 -     bg_color = '#E0FFFF' if clause["type"] == 'ä¸»ç¯€' else '#FFFACD'                           â”‚
 â”‚    520 -     underline_color = "blue" if clause["type"] == "ä¸»ç¯€" else "#DC143C"                       â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚    527 +     bg_color = clause_colors.get(clause["type"], "#FFFFFF")                                   â”‚
 â”‚    528 +     underline_color = "blue" if clause["type"] == "ä¸»ç¯€" else ("#8A2BE2" if clause["type"]    â”‚
 â”‚        == "éå®šå½¢ç¯€" else "#DC143C")                                                                   â”‚
 â”‚    529       display_type = f"{clause['type']}({clause['detailed_type']})" if clause['type'] !=        â”‚
 â”‚          clause['detailed_type'] else clause['type']                                                   â”‚
 â”‚    530       type_description = clause_type_desc.get(clause['detailed_type'],                          â”‚
 â”‚          "ã“ã®ç¯€ã¯æ–‡ã®æ§‹æˆè¦ç´ ã§ã™ã€‚")                                                                 â”‚
 â”‚    531       clause_summaries.append(f'<span style="background-color: {bg_color}; padding: 2px 5px;    â”‚
 â”‚          border-radius: 3px; font-size: 1.2em;" title="{type_description}">{display_type}</span>')     â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ render_clause_highlighted_textã®ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  æœ€å¾Œã«ã€render_clause_structure_tabã‚’ä¿®æ­£ã—ã€éå®šå½¢ç¯€ã®è©³ç´°è¡¨ç¤ºã¨ã€Œæ„å‘³ä¸Šã®ä¸»èªã€ã®è§£èª¬ã‚’è¿½åŠ ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def render_clause_structure_ta... => def render_clause_structure_ta...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    562   def render_clause_structure_tab(elements):                                                    â”‚
 â”‚    563       """ã€Œç¯€ã®æ§‹é€ ã€ã‚¿ãƒ–ã®å†…å®¹ã‚’æç”»"""                                                        â”‚
 â”‚    564       st.markdown("### ç¯€ã®æ§‹é€ ã‚’ç†è§£ã™ã‚‹")                                                     â”‚
 â”‚    565 -     st.markdown(                                                                              â”‚
 â”‚        "ã“ã®æ–‡ãŒæ¥ç¶šè©ãªã©ã§ã©ã†åŒºåˆ‡ã‚‰ã‚Œã€è¤‡æ•°ã®ã€ŒãƒŸãƒ‹æ–‡ã€ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã«   â”‚
 â”‚        ã‚ˆã‚Šã€è¤‡é›‘ãªé•·æ–‡ã‚‚æ„å‘³ã®å¡Šã”ã¨ã«åˆ†è§£ã—ã¦èª­ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚")                                â”‚
 â”‚    565 +     st.markdown(                                                                              â”‚
 â”‚        "ã“ã®æ–‡ãŒæ¥ç¶šè©ã‚„ä¸å®šè©ãªã©ã«ã‚ˆã£ã¦ã©ã†åŒºåˆ‡ã‚‰ã‚Œã€è¤‡æ•°ã®ã€ŒãƒŸãƒ‹æ–‡ã€ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‹ã‚’è¦‹ã¦ã¿ã¾   â”‚
 â”‚        ã—ã‚‡ã†ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è¤‡é›‘ãªé•·æ–‡ã‚‚æ„å‘³ã®å¡Šã”ã¨ã«åˆ†è§£ã—ã¦èª­ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚")                  â”‚
 â”‚    566       clauses = find_clause_elements(elements.doc)                                              â”‚
 â”‚    567 -     if len(clauses) > 1:                                                                      â”‚
 â”‚    567 +     if clauses:                                                                               â”‚
 â”‚    568           st.info(f"**è§£æå¯¾è±¡ã®æ–‡:** {elements.doc.text}")                                     â”‚
 â”‚    569           highlighted_html, clause_summaries = render_clause_highlighted_text(elements.doc,     â”‚
 â”‚          clauses)                                                                                      â”‚
 â”‚    570           st.markdown(" ".join(clause_summaries), unsafe_allow_html=True)                       â”‚
 â”‚    574               "ä¸»ç¯€": "æ–‡ã®æ ¸ã¨ãªã‚‹ä¸»è¦ãªéƒ¨åˆ†ã§ã™ã€‚",                                           â”‚
 â”‚    575               "åè©ç¯€": "æ–‡ã®ä¸­ã§åè©ã¨åŒã˜åƒãï¼ˆä¸»èªã€ç›®çš„èªã€è£œèªï¼‰ã‚’ã—ã¾ã™ã€‚",               â”‚
 â”‚    576               "å½¢å®¹è©ç¯€": "å…ˆè¡Œã™ã‚‹åè©ï¼ˆå…ˆè¡Œè©ï¼‰ã‚’è©³ã—ãèª¬æ˜ï¼ˆä¿®é£¾ï¼‰ã—ã¾ã™ã€‚",                 â”‚
 â”‚    577 -             "å‰¯è©ç¯€": "å‹•è©ã‚’ä¿®é£¾ã—ã€æ™‚ã€ç†ç”±ã€æ¡ä»¶ãªã©ã®è¿½åŠ æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚"              â”‚
 â”‚    577 +             "å‰¯è©ç¯€": "å‹•è©ã‚’ä¿®é£¾ã—ã€æ™‚ã€ç†ç”±ã€æ¡ä»¶ãªã©ã®è¿½åŠ æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚",             â”‚
 â”‚    578 +             "ä¸å®šè©å¥":                                                                       â”‚
 â”‚        "åè©ã€å½¢å®¹è©ã€å‰¯è©ãªã©ã€æ§˜ã€…ãªåƒãã‚’ã—ã¾ã™ã€‚to+å‹•è©ã®åŸå½¢ãŒåŸºæœ¬ã§ã™ã€‚",                        â”‚
 â”‚    579 +             "å‹•åè©å¥": "åè©ã®åƒãã‚’ã—ã¾ã™ã€‚å‹•è©ã®-ingå½¢ãŒä½¿ã‚ã‚Œã¾ã™ã€‚",                     â”‚
 â”‚    580 +             "åˆ†è©å¥": "å½¢å®¹è©ã®ã‚ˆã†ã«åè©ã‚’ä¿®é£¾ã—ãŸã‚Šã€æ–‡ã®çŠ¶æ³ã‚’èª¬æ˜ã—ãŸã‚Šã—ã¾ã™ã€‚"          â”‚
 â”‚    581           }                                                                                     â”‚
 â”‚    582           for i, clause in enumerate(clauses):                                                  â”‚
 â”‚    583               display_type = f"{clause['type']}({clause['detailed_type']})" if clause['type']   â”‚
 â”‚          != clause['detailed_type'] else clause['type']                                                â”‚
 â”‚    584               with st.expander(f"ç¯€ {i+1}: {display_type} ã®è©³ç´°"):                             â”‚
 â”‚    585                   st.markdown(f"**ğŸ’¡ è§£èª¬:** {clause_type_desc.get(clause['detailed_type'],     â”‚
 â”‚          'ã“ã®ç¯€ã¯æ–‡ã®æ§‹æˆè¦ç´ ã§ã™ã€‚')}")                                                              â”‚
 â”‚    583 -                 st.markdown(f"- **ä¸»èª:** {clause['subject'].text if clause.get('subject')    â”‚
 â”‚        else 'N/A'}")                                                                                   â”‚
 â”‚    586 +                                                                                               â”‚
 â”‚    587 +                 subject_text = clause['subject'].text if clause.get('subject') else 'N/A'     â”‚
 â”‚    588 +                 if clause['type'] == 'éå®šå½¢ç¯€' and clause.get('subject'):                    â”‚
 â”‚    589 +                     subject_text += f" (æ„å‘³ä¸Šã®ä¸»èª)"                                        â”‚
 â”‚    590 +                 st.markdown(f"- **ä¸»èª:** {subject_text}")                                    â”‚
 â”‚    591 +                                                                                               â”‚
 â”‚    592                   st.markdown(f"- **å‹•è©:** {clause['verb'].text if clause.get('verb') else     â”‚
 â”‚          'N/A'}")                                                                                      â”‚
 â”‚    593                                                                                                 â”‚
 â”‚    594                   introducer_text = clause['introducer'].text if clause.get('introducer') else  â”‚
 â”‚          'N/A'                                                                                         â”‚
 â”‚    598                                                                                                 â”‚
 â”‚    599                   st.markdown(f"- **ç¯€ã®ç¯„å›²:** `{clause['span'].text}`")                       â”‚
 â”‚    600       else:                                                                                     â”‚
 â”‚    593 -         st.info("ã“ã®æ–‡ã«ã¯ã€è§£æå¯¾è±¡ã¨ãªã‚‹è¤‡æ•°ã®ç¯€ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")                 â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚    601 +         st.info("ã“ã®æ–‡ã«ã¯ã€è§£æå¯¾è±¡ã¨ãªã‚‹ç¯€ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")                       â”‚
 â”‚    602                                                                                                 â”‚
 â”‚    603   def render_dependency_tree_tab(elements):                                                     â”‚
 â”‚    604       """ã€Œå˜èªã®é–¢ä¿‚ã€ã‚¿ãƒ–ã®å†…å®¹ã‚’æç”»"""                                                      â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ ã“ã‚Œã§ãƒ•ã‚§ãƒ¼ã‚º3ã®æœ€åˆã®ã‚¿ã‚¹ã‚¯ã€Œéå®šå½¢ç¯€ã®è­˜åˆ¥ã€ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ä¸å®šè©ãƒ»å‹•åè©ãƒ»åˆ†è©ã¨ã„ã£ãŸ
  ã€ã‚ˆã‚Šé«˜åº¦ãªæ–‡ã®æ§‹æˆè¦ç´ ã‚’ç†è§£ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã¯ãšã§ã™ã€‚

  è¨ˆç”»ã«åŸºã¥ãã€ãƒ•ã‚§ãƒ¼ã‚º3ã®æ¬¡ã®ã‚¿ã‚¹ã‚¯ã€Œç¯€é–“ã®é–¢ä¿‚æ€§ã®å¯è¦–åŒ–ã€ã«é€²ã¿ã¾ã™ã€‚

  ã“ã‚Œã¯ã€æ–‡å…¨ä½“ã®è«–ç†æ§‹é€ ã‚’æ˜ã‚‰ã‹ã«ã™ã‚‹ãŸã‚ã®é‡è¦ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚ä¾‹ãˆã°ã€ã€Œå‰¯è©ç¯€ãŒä¸»ç¯€ã®å‹•è©ã‚’ã©ã®ã‚ˆã†ã«ä¿®é£¾ã—
  ã¦ã„ã‚‹ã‹ã€ã‚„ã€ã€Œå½¢å®¹è©ç¯€ãŒã©ã®åè©ã‚’èª¬æ˜ã—ã¦ã„ã‚‹ã‹ã€ã¨ã„ã£ãŸã€ç¯€ã¨ç¯€ã®é–“ã®ç¹‹ãŒã‚Šã‚’æ˜ç¢ºã«ã—ã¾ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

  å®Œå…¨ãªã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¡¨ç¤ºã¯éå¸¸ã«è¤‡é›‘ãªãŸã‚ã€ã¾ãšã¯ãã®ç¬¬ä¸€æ­©ã¨ã—ã¦ã€å„ç¯€ã®è§£èª¬ã«ã€ãã‚ŒãŒæ–‡ä¸­ã®ã©ã®å˜èªã¨çµã³ã¤ã„
  ã¦ã„ã‚‹ã‹ã‚’ãƒ†ã‚­ã‚¹ãƒˆã§æ˜ç¤ºã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚

   1. `find_clause_elements` é–¢æ•°ã®å†æ‹¡å¼µ:
       * å„å¾“å±ç¯€ã‚„éå®šå½¢ç¯€ãŒã€ã©ã®å˜èªï¼ˆä¸»ç¯€ã®å‹•è©ã‚„åè©ãªã©ï¼‰ã«ä¿‚ã£ã¦ã„ã‚‹ã‹ï¼ˆheadãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã‚’ç‰¹å®šã—ã€ãã®æƒ…å ±ã‚’
         ç¯€ã®ãƒ‡ãƒ¼ã‚¿ã«å«ã‚ã¾ã™ã€‚

   2. `render_clause_structure_tab` é–¢æ•°ã®æ›´æ–°:
       * ç¯€ã®è©³ç´°è¡¨ç¤ºã®ä¸­ã«ã€ã€Œä¿‚ã‚Šå—ã‘: ã“ã®ç¯€ã¯ [å˜èª]
         ã‚’ä¿®é£¾ã—ã¦ã„ã¾ã™ã€‚ã€ã¨ã„ã£ãŸå½¢ã§ã€é–¢ä¿‚æ€§ã®èª¬æ˜ã‚’è¿½åŠ ã—ã¾ã™ã€‚

  ã“ã®å®Ÿè£…ã«ç€æ‰‹ã—ã¦ã‚ˆã‚ã—ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿæ‰¿çŸ¥ã„ãŸã—ã¾ã—ãŸã€‚ã€Œç¯€é–“ã®é–¢ä¿‚æ€§ã®å¯è¦–åŒ–ã€ã®ç¬¬ä¸€æ­©ã¨ã—ã¦ã€ç¯€ãŒã©ã®å˜èªã«
  ä¿‚ã£ã¦ã„ã‚‹ã‹ã‚’ãƒ†ã‚­ã‚¹ãƒˆã§è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã®å®Ÿè£…ã‚’é–‹å§‹ã—ã¾ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

   1. `find_clause_elements` é–¢æ•°ã®ä¿®æ­£:
       * å„å¾“å±ç¯€ãƒ»éå®šå½¢ç¯€ãŒã€ã©ã®å˜èªï¼ˆheadï¼‰ã«ä¾å­˜ã—ã¦ã„ã‚‹ã‹ã‚’ç‰¹å®šã—ã€ãã®æƒ…å ±ã‚’ç¯€ã®ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚spa
         Cyã§ã¯ã€ç¯€ã®æ ¸ã¨ãªã‚‹å‹•è©ã® .head å±æ€§ã‚’èª¿ã¹ã‚‹ã“ã¨ã§ã€ã“ã®é–¢ä¿‚æ€§ã‚’ç‰¹å®šã§ãã¾ã™ã€‚

   2. `render_clause_structure_tab` é–¢æ•°ã®æ›´æ–°:
       * ç¯€ã®è©³ç´°è¡¨ç¤ºã«ã€Œä¿‚ã‚Šå—ã‘ã€ã¨ã„ã†é …ç›®ã‚’è¿½åŠ ã—ã€ã€Œã“ã®ç¯€ã¯ [å˜èª]
         ã‚’ä¿®é£¾ï¼ˆèª¬æ˜ï¼‰ã—ã¦ã„ã¾ã™ã€ã¨ã„ã£ãŸå½¢ã§ã€é–¢ä¿‚æ€§ã‚’æ˜ç¤ºã—ã¾ã™ã€‚

  ã¾ãšã¯ã€find_clause_elementsé–¢æ•°ã‚’ä¿®æ­£ã—ã€å„ç¯€ã®headæƒ…å ±ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def find_clause_elements(doc):... => def find_clause_elements(doc):...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    431       main_verb = next((t for t in sent if t.dep_ == "ROOT" and t.pos_ in ["VERB", "AUX"]),     â”‚
 â”‚          None)                                                                                         â”‚
 â”‚    432       if main_verb:                                                                             â”‚
 â”‚    433           subject = next((c for c in main_verb.children if c.dep_ in ["nsubj", "nsubjpass"]),   â”‚
 â”‚          None)                                                                                         â”‚
 â”‚    434 -         clauses.append({"type": "ä¸»ç¯€", "detailed_type": "ä¸»ç¯€", "verb": main_verb,           â”‚
 â”‚        "subject": subject, "introducer": None, "span": sent, "omitted_introducer_text": None})         â”‚
 â”‚    434 +         clauses.append({"type": "ä¸»ç¯€", "detailed_type": "ä¸»ç¯€", "verb": main_verb,           â”‚
 â”‚        "subject": subject, "introducer": None, "span": sent, "omitted_introducer_text": None, "head":  â”‚
 â”‚        main_verb})                                                                                     â”‚
 â”‚    435           for conj_verb in main_verb.conjuncts:                                                 â”‚
 â”‚    436               conj_subject = next((c for c in conj_verb.children if c.dep_ in ["nsubj",         â”‚
 â”‚          "nsubjpass"]), None)                                                                          â”‚
 â”‚    437               if conj_subject:                                                                  â”‚
 â”‚    438 -                 clauses.append({"type": "ä¸»ç¯€", "detailed_type": "ä¸»ç¯€", "verb": conj_verb,   â”‚
 â”‚        "subject": conj_subject, "introducer": None, "span": conj_verb.sent, "omitted_introducer_text"  â”‚
 â”‚        : None})                                                                                        â”‚
 â”‚    438 +                 clauses.append({"type": "ä¸»ç¯€", "detailed_type": "ä¸»ç¯€", "verb": conj_verb,   â”‚
 â”‚        "subject": conj_subject, "introducer": None, "span": conj_verb.sent, "omitted_introducer_text"  â”‚
 â”‚        : None, "head": conj_verb})                                                                     â”‚
 â”‚    439                                                                                                 â”‚
 â”‚    440   # å®šå½¢å¾“å±ç¯€ã¨éå®šå½¢ç¯€ã®æ¤œå‡º                                                                  â”‚
 â”‚    441   for token in doc:                                                                             â”‚
 â”‚    442       clause_info = None                                                                        â”‚
 â”‚    443       # å®šå½¢å¾“å±ç¯€                                                                              â”‚
 â”‚    444       if token.dep_ in finite_clause_type_map:                                                  â”‚
 â”‚    445 -         clause_info = {"type": "å¾“å±ç¯€", "detailed_type":                                     â”‚
 â”‚        finite_clause_type_map[token.dep_], "verb": token}                                              â”‚
 â”‚    445 +         clause_info = {"type": "å¾“å±ç¯€", "detailed_type":                                     â”‚
 â”‚        finite_clause_type_map[token.dep_], "verb": token, "head": token.head}                          â”‚
 â”‚    446       # éå®šå½¢ç¯€                                                                                â”‚
 â”‚    447       elif token.dep_ in non_finite_clause_type_map and token.pos_ == "VERB":                   â”‚
 â”‚    448           detailed_type = ""                                                                    â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚    458                detailed_type = "ä¸å®šè©å¥"                                                       â”‚
 â”‚    459                                                                                                 â”‚
 â”‚    460           if detailed_type:                                                                     â”‚
 â”‚    461 -             clause_info = {"type": "éå®šå½¢ç¯€", "detailed_type": detailed_type, "verb":        â”‚
 â”‚        token}                                                                                          â”‚
 â”‚    461 +             clause_info = {"type": "éå®šå½¢ç¯€", "detailed_type": detailed_type, "verb":        â”‚
 â”‚        token, "head": token.head}                                                                      â”‚
 â”‚    462                                                                                                 â”‚
 â”‚    463       if clause_info:                                                                           â”‚
 â”‚    464           verb = clause_info['verb']                                                            â”‚
 â”‚    470           if not subject:                                                                       â”‚
 â”‚    471               if verb.dep_ in ["relcl", "acl"] and verb.pos_ == "PRON": subject = verb # who,   â”‚
 â”‚          which                                                                                         â”‚
 â”‚    472               elif verb.dep_ == "acl": subject = verb.head # åˆ†è©ãŒä¿®é£¾ã™ã‚‹åè©                 â”‚
 â”‚    473 -             elif verb.dep_ == "xcomp": subject = next((s for s in verb.head.children if       â”‚
 â”‚        s.dep_ == 'nsubj'), None) # I want to go -> I                                                   â”‚
 â”‚    473 +             elif verb.dep_ == "xcomp": subject = next((s for s in verb.head.children if       â”‚
 â”‚        s.dep_ == 'nsubj'), verb.head) # I want to go -> I                                              â”‚
 â”‚    474                                                                                                 â”‚
 â”‚    475           # å°å…¥èªã®ç‰¹å®šãƒ­ã‚¸ãƒƒã‚¯                                                                â”‚
 â”‚    476           if clause_info['type'] == 'å¾“å±ç¯€':                                                   â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ find_clause_elementsé–¢æ•°ã®ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  æœ€å¾Œã«ã€ã“ã®æ–°ã—ã„ã€Œä¿‚ã‚Šå—ã‘ã€æƒ…å ±ã‚’UIã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã€render_clause_structure_tabé–¢æ•°ã‚’ä¿®æ­£ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def render_clause_structure_ta... => def render_clause_structure_ta...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    596                   introducer_text = f"<span style='color: #999; font-style: italic;'>({clause[  â”‚
 â”‚          'omitted_introducer_text']})</span> â€»çœç•¥"                                                    â”‚
 â”‚    597               st.markdown(f"- **å°å…¥èª:** {introducer_text}", unsafe_allow_html=True)           â”‚
 â”‚    598                                                                                                 â”‚
 â”‚    599 +             if clause['type'] != 'ä¸»ç¯€' and clause.get('head'):                               â”‚
 â”‚    600 +                 st.markdown(f"- **ä¿‚ã‚Šå—ã‘:** ã“ã®ç¯€ã¯`{clause['head'].text}                  â”‚
 â”‚        `ã‚’ä¿®é£¾ãƒ»èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚")                                                                     â”‚
 â”‚    601 +                                                                                               â”‚
 â”‚    602               st.markdown(f"- **ç¯€ã®ç¯„å›²:** `{clause['span'].text}`")                           â”‚
 â”‚    603   else:                                                                                         â”‚
 â”‚    604       st.info("ã“ã®æ–‡ã«ã¯ã€è§£æå¯¾è±¡ã¨ãªã‚‹ç¯€ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")                           â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ ã“ã‚Œã§ã€Œç¯€é–“ã®é–¢ä¿‚æ€§ã®å¯è¦–åŒ–ã€ã®ç¬¬ä¸€æ­©ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  è¨ˆç”»ã«åŸºã¥ãã€ãƒ•ã‚§ãƒ¼ã‚º3ã®æ¬¡ã®ã‚¿ã‚¹ã‚¯ã€Œæ–‡å‹åˆ¤å®š: å¥å‹•è© (Phrasal Verbs) ã®è€ƒæ…®ã€ã«é€²ã¿ã¾ã™ã€‚

  look upã‚„put
  offã®ã‚ˆã†ãªå¥å‹•è©ã¯ã€è¤‡æ•°ã®å˜èªã§ä¸€ã¤ã®å‹•è©ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ãŸã‚ã€ç¾åœ¨ã®ãƒ­ã‚¸ãƒƒã‚¯ã§ã¯æ­£ã—ãè§£é‡ˆã§ããªã„å ´åˆãŒã‚ã‚Š
  ã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€å¥å‹•è©ã‚’ä¸€ã¤ã®æ„å‘³å˜ä½ã¨ã—ã¦èªè­˜ã—ã€æ–‡å‹åˆ¤å®šã®ç²¾åº¦ã‚’ã•ã‚‰ã«å‘ä¸Šã•ã›ã¾ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

   1. ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®æ‹¡å¼µ:
       * SentenceElementsã¨ã„ã†åå‰ä»˜ãã‚¿ãƒ—ãƒ«ã«ã€å¥å‹•è©ã®ä¸å¤‰åŒ–è©ï¼ˆup,
         offãªã©ï¼‰ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã®particleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

   2. `find_potential_elements`é–¢æ•°ã®ä¿®æ­£:
       * å‹•è©ã‚’ç‰¹å®šã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã®ä¸­ã§ã€ãã®å‹•è©ã«prtã¨ã„ã†ä¾å­˜é–¢ä¿‚ã§çµã³ã¤ã„ãŸä¸å¤‰åŒ–è©ãŒãªã„ã‹ã‚’æ¢ã—ã¾ã™ã€‚
       * è¦‹ã¤ã‹ã£ãŸå ´åˆã¯ã€ãã‚Œã‚’particleã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚

   3. UIã®æ›´æ–° (`render_highlighted_text`ãªã©):
       * ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºã®éš›ã«ã€å‹•è©ã ã‘ã§ãªãä¸å¤‰åŒ–è©ã‚‚å‹•è©ã®ä¸€éƒ¨ã¨ã—ã¦åŒã˜è‰²ã§è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
       * ã€Œæ–‡ã®éª¨æ ¼ã€ã‚¿ãƒ–ã®æ§‹æˆè¦ç´ è¡¨ç¤ºã§ã‚‚ã€å¥å‹•è©ãŒä¸€ä½“ã¨ã—ã¦èªè­˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«èª¿æ•´ã—ã¾ã™ã€‚

  ã¾ãšã¯ã€ãƒ‡ãƒ¼ã‚¿æ§‹é€ (SentenceElements)ã®å¤‰æ›´ã¨ã€find_potential_elementsãŠã‚ˆã³analyze_sentenceã¸ã®ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ ã‚’
  ä¸€åº¦ã«è¡Œã„ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: # --- ãƒ‡ãƒ¼ã‚¿æ§‹é€  ---... => # --- ãƒ‡ãƒ¼ã‚¿æ§‹é€  ---...                           â”‚
 â”‚                                                                                                        â”‚
 â”‚     28                                                                                                 â”‚
 â”‚     29   # --- ãƒ‡ãƒ¼ã‚¿æ§‹é€  ---                                                                          â”‚
 â”‚     30   SentenceElements = namedtuple('SentenceElements', [                                           â”‚
 â”‚     31 -     'subject', 'verb', 'dobj', 'iobj', 'complement', 'agent', 'voice', 'pattern_name', 'doc'  â”‚
 â”‚     31 +     'subject', 'verb', 'particle', 'dobj', 'iobj', 'complement', 'agent', 'voice',            â”‚
 â”‚        'pattern_name', 'doc'                                                                           â”‚
 â”‚     32   ])                                                                                            â”‚
 â”‚     33                                                                                                 â”‚
 â”‚     34   # --- spaCyãƒ¢ãƒ‡ãƒ«ã®ãƒ­ãƒ¼ãƒ‰ ---                                                                 â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚     49                                                                                                 â”‚
 â”‚     50   def find_potential_elements(doc):                                                             â”‚
 â”‚     51       """æ–‡ã‹ã‚‰è¦ç´ ã®å€™è£œã‚’ã™ã¹ã¦æ´—ã„å‡ºã™"""                                                    â”‚
 â”‚     52 -     elements = {'verb': None, 'subject': None, 'dobj': None, 'iobj': None, 'complement':      â”‚
 â”‚        None, 'agent': None, 'voice': 'èƒ½å‹•æ…‹', 'doc': doc}                                             â”‚
 â”‚     52 +     elements = {'verb': None, 'particle': None, 'subject': None, 'dobj': None, 'iobj': None,  â”‚
 â”‚        'complement': None, 'agent': None, 'voice': 'èƒ½å‹•æ…‹', 'doc': doc}                               â”‚
 â”‚     53                                                                                                 â”‚
 â”‚     54       # æ…‹ã¨ä¸­å¿ƒå‹•è©ã®ç‰¹å®š                                                                      â”‚
 â”‚     55       passive_verb = next((t.head for t in doc if t.dep_ == "auxpass" and t.head.pos_ ==        â”‚
 â”‚          "VERB"), None)                                                                                â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚     68               return elements                                                                   â”‚
 â”‚     69                                                                                                 â”‚
 â”‚     70           elements['verb'] = main_verb                                                          â”‚
 â”‚     71 +         elements['particle'] = next((c for c in main_verb.children if c.dep_ == "prt"), None  â”‚
 â”‚        )                                                                                               â”‚
 â”‚     72                                                                                                 â”‚
 â”‚     73           # Subject                                                                             â”‚
 â”‚     74           elements['subject'] = next((c for c in main_verb.children if c.dep_ in ["nsubj",      â”‚
 â”‚          "csubj"]), None)                                                                              â”‚
 â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
 â”‚    151       potential_elements = find_potential_elements(doc)                                         â”‚
 â”‚    152       print(f"[DEBUG] In analyze_sentence, potential_elements keys:                             â”‚
 â”‚          {potential_elements.keys()}")                                                                 â”‚
 â”‚    153       if not potential_elements.get('verb'):                                                    â”‚
 â”‚    153 -         return SentenceElements(None, None, None, None, None, None, 'ä¸æ˜', 'ä¸æ˜', doc)      â”‚
 â”‚    154 +         return SentenceElements(None, None, None, None, None, None, None, 'ä¸æ˜', 'ä¸æ˜',     â”‚
 â”‚        doc)                                                                                            â”‚
 â”‚    155                                                                                                 â”‚
 â”‚    156       pattern_name = determine_sentence_pattern(potential_elements)                             â”‚
 â”‚    157                                                                                                 â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ ãƒ­ã‚¸ãƒƒã‚¯éƒ¨åˆ†ã®ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  æ¬¡ã«ã€ã“ã®å¥å‹•è©ã®æƒ…å ±ã‚’UIã«åæ˜ ã•ã›ã‚‹ãŸã‚ã€ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºã¨æ§‹æˆè¦ç´ ã®è¡¨ç¤ºã‚’ä¿®æ­£ã—ã¾ã™ã€‚

  å®Ÿè£…è¨ˆç”»:

   1. `render_highlighted_text` é–¢æ•°ã®ä¿®æ­£:
       * å‹•è©ï¼ˆverbï¼‰ã ã‘ã§ãªãã€ä¸å¤‰åŒ–è©ï¼ˆparticleï¼‰ã‚‚å‹•è©ã¨åŒã˜è‰²ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹ã‚ˆã†ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¾ã™ã€‚

   2. `render_pattern_and_voice_tab` é–¢æ•°ã®ä¿®æ­£:
       * ã€Œæ§‹æˆè¦ç´ ã€ã®è¡¨ç¤ºéƒ¨åˆ†ã§ã€å‹•è©ã¨ä¸å¤‰åŒ–è©ã‚’ã¾ã¨ã‚ã¦ã€Œå‹•è© (V)ã€ã¨ã—ã¦è¡¨ç¤ºã—ã€look
         upã®ã‚ˆã†ãªå¥å‹•è©ãŒä¸€ä½“ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’è¦–è¦šçš„ã«ç¤ºã—ã¾ã™ã€‚

  ã¾ãšã¯ã€render_highlighted_texté–¢æ•°ã‚’ä¿®æ­£ã—ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def render_highlighted_text(do... => def render_highlighted_text(do...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    239   element_map = {                                                                               â”‚
 â”‚    240       elements.subject: ("ä¸»èª (S)", "#ADD8E6"),                                                â”‚
 â”‚    241       elements.verb: ("å‹•è© (V)", "#FFB6C1"),                                                   â”‚
 â”‚    242 +     elements.particle: ("å‹•è© (V)", "#FFB6C1"), # å¥å‹•è©ã®ä¸å¤‰åŒ–è©ã‚‚å‹•è©ã¨ã—ã¦ãƒã‚¤ãƒ©ã‚¤ãƒˆ      â”‚
 â”‚    243       elements.dobj: ("ç›®çš„èª (O)", "#FFDAB9"),                                                 â”‚
 â”‚    244       elements.iobj: ("é–“æ¥ç›®çš„èª (O)", "#90EE90"),                                             â”‚
 â”‚    245       elements.complement: ("è£œèª (C)", "#D8BFD8"),                                             â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ render_highlighted_textã®ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  æœ€å¾Œã«ã€render_pattern_and_voice_tabã‚’ä¿®æ­£ã—ã€æ§‹æˆè¦ç´ ã®è¡¨ç¤ºã‚’å¥å‹•è©ã«å¯¾å¿œã•ã›ã¾ã™ã€‚
 â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
 â”‚ âœ”  Edit spacy_app\app.py: def render_pattern_and_voice_t... => def render_pattern_and_voice_t...       â”‚
 â”‚                                                                                                        â”‚
 â”‚    285           st.markdown("ğŸ’¡ **è§£èª¬:**                                                             â”‚
 â”‚          ã“ã®æ–‡ã¯èƒ½å‹•æ…‹ã§ã™ã€‚ä¸»èªãŒå‹•ä½œã‚’ã€è¡Œã†å´ã€ã«ãªã£ã¦ã„ã¾ã™ã€‚")                                  â”‚
 â”‚    286                                                                                                 â”‚
 â”‚    287   st.markdown("---")                                                                            â”‚
 â”‚    288 - display_elements = sorted([(e.i, f'<span style="background-color: {c}; padding: 2px 5px;      â”‚
 â”‚        border-radius: 3px;">{l}</span>') for r, e in elements._asdict().items() if e and r in {        â”‚
 â”‚        "subject":"ä¸»èª (S)", "verb":"å‹•è© (V)", "dobj":"ç›®çš„èª (O)", "iobj":"é–“æ¥ç›®çš„èª (O)",          â”‚
 â”‚        "complement":"è£œèª (C)"} for l,c in [({"subject":"ä¸»èª (S)", "verb":"å‹•è© (V)", "dobj":"ç›®çš„èª  â”‚
 â”‚        (O)", "iobj":"é–“æ¥ç›®çš„èª (O)", "complement":"è£œèª (C)"}[r], {"subject":"#ADD8E6", "verb":       â”‚
 â”‚        "#FFB6C1", "dobj":"#FFDAB9", "iobj":"#90EE90", "complement":"#D8BFD8"}[r])]], key=lambda x: x[  â”‚
 â”‚        0])                                                                                             â”‚
 â”‚    289 - st.markdown(f"<p><b>æ§‹æˆè¦ç´ :</b> {' '.join([item[1] for item in display_elements])}</p>",    â”‚
 â”‚        unsafe_allow_html=True)                                                                         â”‚
 â”‚    288 + # æ§‹æˆè¦ç´ ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¿®æ­£                                                                â”‚
 â”‚    289 + element_definitions = {                                                                       â”‚
 â”‚    290 +     "subject": ("ä¸»èª (S)", "#ADD8E6"),                                                       â”‚
 â”‚    291 +     "verb": ("å‹•è© (V)", "#FFB6C1"),                                                          â”‚
 â”‚    292 +     "dobj": ("ç›®çš„èª (O)", "#FFDAB9"),                                                        â”‚
 â”‚    293 +     "iobj": ("é–“æ¥ç›®çš„èª (O)", "#90EE90"),                                                    â”‚
 â”‚    294 +     "complement": ("è£œèª (C)", "#D8BFD8"),                                                    â”‚
 â”‚    295 + }                                                                                             â”‚
 â”‚    296 + display_parts = []                                                                            â”‚
 â”‚    297 + verb_part = elements.verb.text                                                                â”‚
 â”‚    298 + if elements.particle:                                                                         â”‚
 â”‚    299 +     verb_part += f" {elements.particle.text}"                                                 â”‚
 â”‚    300 +                                                                                               â”‚
 â”‚    301 + # å‹•è©ã‚’å…ˆã«è¿½åŠ                                                                               â”‚
 â”‚    302 + display_parts.append((elements.verb.i, f'<span style="background-color: #FFB6C1; padding:     â”‚
 â”‚        2px 5px; border-radius: 3px;">å‹•è© (V): {verb_part}</span>'))                                   â”‚
 â”‚    303 +                                                                                               â”‚
 â”‚    304 + # ä»–ã®è¦ç´ ã‚’è¿½åŠ                                                                               â”‚
 â”‚    305 + for key, (label, color) in element_definitions.items():                                       â”‚
 â”‚    306 +     if key != 'verb':                                                                         â”‚
 â”‚    307 +         element = getattr(elements, key)                                                      â”‚
 â”‚    308 +         if element:                                                                           â”‚
 â”‚    309 +             display_parts.append((element.i, f'<span style="background-color: {color};        â”‚
 â”‚        padding: 2px 5px; border-radius: 3px;">{label}: {element.text}</span>'))                        â”‚
 â”‚    310 +                                                                                               â”‚
 â”‚    311 + # ãƒˆãƒ¼ã‚¯ãƒ³ã®å‡ºç¾é †ã«ã‚½ãƒ¼ãƒˆ                                                                    â”‚
 â”‚    312 + display_parts.sort(key=lambda x: x[0])                                                        â”‚
 â”‚    313 + st.markdown(f"<p><b>æ§‹æˆè¦ç´ :</b> {' '.join([item[1] for item in display_parts])}</p>",       â”‚
 â”‚        unsafe_allow_html=True)                                                                         â”‚
 â”‚    314 +                                                                                               â”‚
 â”‚    315   st.markdown(f"#### ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º")                                                           â”‚
 â”‚    316   st.markdown(render_highlighted_text(elements.doc, elements), unsafe_allow_html=True)          â”‚
 â”‚    317                                                                                                 â”‚
 â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
âœ¦ ã“ã‚Œã§ã€Œå¥å‹•è©ã®è€ƒæ…®ã€ã«é–¢ã™ã‚‹å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

  ä»¥ä¸Šã§ã€ææ¡ˆã•ã‚Œã¦ã„ãŸæ”¹å–„è¨ˆç”»ã®ãƒ•ã‚§ãƒ¼ã‚º1ã‹ã‚‰ãƒ•ã‚§ãƒ¼ã‚º3ã¾ã§ã®ä¸»è¦ãªã‚¿ã‚¹ã‚¯ã¯ã™ã¹ã¦å®Œäº†ã¨ãªã‚Šã¾ã™ã€‚

   * ãƒ•ã‚§ãƒ¼ã‚º1: å³åŠ¹æ€§ã®ã‚ã‚‹æ”¹å–„ã¨åŸºç›¤ã®å¼·åŒ– (å®Œäº†)
       * å½¢å¼ä¸»èª It ã®è©³ç´°ãªæ‰±ã„
       * å¾“å±ç¯€ã®ç¨®é¡ã®è©³ç´°ãªåˆ†é¡
       * çœç•¥ã•ã‚ŒãŸè¦ç´ ã®è£œå®Œ (thatç¯€)
   * ãƒ•ã‚§ãƒ¼ã‚º2: è¦–è¦šçš„è¡¨ç¾ã¨æ·±ã„ç†è§£ã®ä¿ƒé€² (å®Œäº†)
       * ã‚ˆã‚Šå¤šæ§˜ãªå¥ã®åˆ†è§£
       * è¦–è¦šçš„ãªè¡¨ç¾ã®å¼·åŒ–ï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ„ãƒªãƒ¼ï¼‰
       * ã‚ˆã‚Šè©³ç´°ãªSVOC/SVCã®åˆ†é¡
   * ãƒ•ã‚§ãƒ¼ã‚º3: é«˜åº¦ãªæ–‡æ³•ç¾è±¡ã¨å¿œç”¨ (å®Œäº†)
       * éå®šå½¢ç¯€ã®è­˜åˆ¥
       * ç¯€é–“ã®é–¢ä¿‚æ€§ã®å¯è¦–åŒ–ï¼ˆä¿‚ã‚Šå—ã‘è¡¨ç¤ºï¼‰
       * å¥å‹•è©ã®è€ƒæ…®

  ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€å½“åˆã®è¨ˆç”»ã‚’å¤§å¹…ã«è¶…ãˆã€éå¸¸ã«é«˜åº¦ã§å¤šè§’çš„ãªè‹±æ–‡è§£ææ©Ÿèƒ½ã‚’æŒã¤ã«è‡³ã‚Šã¾ã—ãŸã€‚

  ä»Šå¾Œã®æ–¹å‘æ€§ã¨ã—ã¦ã€æ®‹ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã§ã‚ã‚‹ã€Œæ–‡å‹åˆ¤å®šã®å„ªå…ˆé †ä½ã®å‹•çš„ãªèª¿æ•´ã€ï¼ˆã‚ˆã‚Šé«˜åº¦ãªã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®å°
  å…¥ãªã©ï¼‰ã«å–ã‚Šçµ„ã‚€ã“ã¨ã‚‚å¯èƒ½ã§ã™ã—ã€ã‚ã‚‹ã„ã¯ã€ã“ã‚Œã¾ã§ã®å®Ÿè£…ã‚’å®‰å®šã•ã›ã‚‹ãŸã‚ã®ç·åˆçš„ãªãƒ†ã‚¹ãƒˆã¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
  ã«æ™‚é–“ã‚’ã‹ã‘ã‚‹ã“ã¨ã‚‚æœ‰ç›Šã§ã™ã€‚

  